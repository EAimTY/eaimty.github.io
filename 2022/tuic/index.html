<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=#000000 id=color_chrome name=theme-color><meta content=#000000 id=color_safari name=apple-mobile-web-app-status-bar-style><meta content="EAimTY's Blog" name=description><link rel="Shortcut Icon" href=https://www.eaimty.com/favicon.ico><link href=https://www.eaimty.com/favicon.ico rel=Bootmark><link title="EAimTY's Blog" href=https://www.eaimty.com/rss.xml rel=alternate type=application/rss+xml><style>#title,body{line-height:1.6em}body{background:#000;color:#00c000;font-size:1.2em}#container{margin:2.4em auto;width:72%}#header{text-align:center}#header>a{font-size:.96em;margin:auto 1em}#title{font-size:1.6em;font-weight:700;margin:1em auto}#date{font-style:italic}#list>li{margin:.8em auto;list-style:disc}img{max-width:100%}a{color:inherit;text-decoration:none}#content a,a:hover{text-decoration:underline}pre{padding:1em;overflow:auto;background:#1b1d16}:not(pre) >code{padding:.2em;background:#1b1d16;overflow:auto}blockquote{padding:0 1em;margin:0;border-left:.25em solid #212121}@media (max-width:600px){#container{width:88%}#header>a{margin:auto .3em}}</style><title>åŸºäº QUIC çš„ä»£ç†è½¯ä»¶ï¼šTUIC - EAimTY's Blog</title><body><div id=header><a href=https://www.eaimty.com>EAimTY's Blog</a><a href=https://www.eaimty.com/about/>About</a><a href=https://www.eaimty.com/friends/>Friends</a></div><div id=container><a href=https://www.eaimty.com/2022/tuic/ id=title>åŸºäº QUIC çš„ä»£ç†è½¯ä»¶ï¼šTUIC</a><div id=date>2022-03-10</div><div id=content><p>QUIC åè®®æ±²å–äº†å¤§é‡äººä»¬ç»™ TCP ç³Šå¢™çš„ç»éªŒæ•™è®­ï¼ŒæŠŠè¿æ¥ç»“æ„ä¼˜åŒ–åˆ°ï¼ˆç›®å‰æ¥çœ‹ï¼‰æè‡´ã€‚ä½†æ˜¯ç°åœ¨å¸‚é¢ä¸Šçš„ä»£ç†å·¥å…·è¿˜æ²¡æœ‰èƒ½å®Œå…¨åˆ©ç”¨ QUIC ç‰¹æ€§çš„å­˜åœ¨ï¼Œæ‰€ä»¥æˆ‘è‡ªå·±åŠ¨æ‰‹å†™äº†ä¸€ä¸ªåŸºäº QUIC åè®®çš„æ–°ä»£ç†å·¥å…·ï¼šTUIC<p>https://github.com/EAimTY/tuic<ul><li>1-RTT TCP ä¸­ç»§<li>0-RTT UDP ä¸­ç»§ï¼Œä¸” NAT ç±»å‹ä¸º FullCone<li>åœ¨ç”¨æˆ·ç©ºé—´çš„æ‹¥å¡æ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åœ¨ä»»ä½•ç³»ç»Ÿå¹³å°å®ç°åŒå‘çš„ BBR<li>ä¸¤ç§ UDP ä¸­ç»§æ¨¡å¼: native ï¼ˆåŸç”Ÿ UDP ç‰¹æ€§ï¼Œæ•°æ®ä»è¢« TLS åŠ å¯†ï¼‰å’Œ quic (100% é€è¾¾ç‡ï¼Œæ¯ä¸ªåŒ…å•ç‹¬å•ç‹¬ä½œä¸ºä¸€ä¸ª QUIC â€œæµâ€ï¼Œä¸€ä¸ªåŒ…çš„ç¡®è®¤é‡ä¼ ä¸ä¼šé˜»å¡å…¶å®ƒåŒ…)<li>å®Œå…¨å¤šè·¯å¤ç”¨ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´å§‹ç»ˆåªéœ€è¦ä¸€æ¡ QUIC è¿æ¥ï¼Œæ‰€æœ‰ä»»åŠ¡ä½œä¸ºè¿™ä¸ªè¿æ¥ä¸­çš„ â€œæµâ€ è¿›è¡Œä¼ è¾“ï¼ˆä¸€ä¸ªæµçš„æš‚æ—¶é˜»å¡ä¸ä¼šå½±å“å…¶å®ƒæµï¼‰ï¼Œæ‰€ä»¥é™¤è¿æ¥ç¬¬ä¸€ä¸ªä¸­ç»§ä»»åŠ¡å¤–çš„å…¶å®ƒä»»åŠ¡éƒ½ä¸éœ€è¦ç»è¿‡ QUIC æ¡æ‰‹å’Œ TUIC çš„é‰´æƒ<li>ç½‘ç»œåˆ‡æ¢æ—¶çš„ä¼šè¯å¹³æ»‘è½¬ç§»ï¼Œä¾‹å¦‚åœ¨ä» Wi-Fi åˆ‡æ¢åˆ°ç§»åŠ¨æ•°æ®æ—¶è¿æ¥ä¸ä¼šåƒ TCP ä¸€æ ·ç›´æ¥æ–­å¼€<li>0-RTT ã€ä¸ä¸­ç»§ä»»åŠ¡å¹¶è¡Œçš„é‰´æƒ<li>æ”¯æŒ QUIC çš„ 0-RTT æ¡æ‰‹ï¼ˆå¼€å¯ä¹‹åèƒ½è¾¾åˆ° çœŸãƒ»1-RTT TCP å’Œ 0-RTT UDP ï¼Œä½†æ˜¯å°±ç®—ä¸å¼€å¯ï¼Œå¤šè·¯å¤ç”¨çš„ç‰¹æ€§ä¹Ÿèƒ½ä¿è¯åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ 1-RTT å’Œ 0-RTT ï¼‰</ul><p>TUIC çš„è®¾è®¡ä»‹ç»åœ¨ä»“åº“ä¸­ <a href=https://github.com/EAimTY/tuic#design>Design</a> ä¸€èŠ‚æœ‰è¯´æ˜ã€‚TUIC åè®®çš„è¯¦ç»†å†…å®¹åœ¨<a href=https://github.com/EAimTY/tuic/tree/master/protocol>è¿™é‡Œ</a>ã€‚ç®€å•æ¥è¯´ï¼ŒTUIC çš„è®¾è®¡æ ¸å¿ƒå°±æ˜¯å‡å°‘æ¡æ‰‹é€ æˆçš„ç½‘ç»œå¾€è¿”æ—¶å»¶ï¼ˆ rtt ï¼‰ï¼Œæ¯•ç«Ÿå¯¹äºç½‘ç»œç¨‹åºè¿™æ˜¯æœ€å¤§çš„ç“¶é¢ˆã€‚<p>å¯¹æ¯”å…¶å®ƒä½¿ç”¨ TCP çš„ä»£ç†å·¥å…·ï¼ˆ ss ã€v2ray ã€trojan ï¼‰ï¼ŒTCP æ¡æ‰‹æ…¢ï¼Œä¸”ä¸æ”¯æŒè‡ªå®šä¹‰æ‹¥å¡æ§åˆ¶ï¼Œå„å·¥å…·å¯¹ UDP çš„æ”¯æŒä¹Ÿå„æœ‰é—®é¢˜ã€‚å¯¹æ¯” <a href=https://github.com/HyNetwork/hysteria>Hysteria</a> ï¼ŒHysteria çš„ UDP ä¸­ç»§éœ€è¦ 1 rtt çš„æ¡æ‰‹ï¼Œä¸”åªæ”¯æŒä¸€ç§ UDP æ¨¡å¼ã€‚<p>æœ€åè¯´è¯´å®‰å…¨æ€§å’Œåè®®ç‰¹å¾ã€‚TUIC ç°åœ¨åŸºäºåŸç”Ÿ QUIC ï¼Œä¸æ”¯æŒ obfs ï¼Œä½† QUIC è¿æ¥æœ¬èº«å°±æ˜¯ TLS åŠ å¯†çš„ï¼Œæ¯ä¸ª QUIC è¿æ¥ä»å¤–é¢çœ‹éƒ½æ˜¯ä¸€æ ·çš„ã€‚å›½å†…çš„å„å¤§å‚ä¹Ÿæ…¢æ…¢å¼€å§‹ä½¿ç”¨ QUIC äº†ï¼Œæ‰€ä»¥æˆ‘è§‰å¾— QUIC ç‰¹å¾åº”è¯¥ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ã€‚</div><div id=comments-issue-id style=display:none>51</div><div id=comments-addition style=display:none>[{"user":{"login":"est","html_url":"https://blog.est.im/","avatar_url":"https://secure.gravatar.com/avatar/a1e570c0195f7dfead850afe83a62d43?d=retro"},"created_at":"2022-11-12T00:26:21Z","body":"å…¶å®1æ ¹è¿æ¥å¹¶ä¸æ˜¯ä»€ä¹ˆå¥½äº‹å‘€ã€‚ç½‘ç»œæµé‡åˆ†æç›´æ¥æ‹¿1ä¸ªè¿æ¥å°±èƒ½metadata åˆ†ææ‰€æœ‰æ•°æ®ï¼Œå…¶å®æœ€å¥½çš„æ–¹å¼æ˜¯M:N è¿æ¥ã€‚å› ä¸ºæ¯ä¸€ä¸ªç½‘ç»œåŒ…çš„è·¯ç”±éƒ½ä¼šç¨å¾®ä¸åŒï¼Œæ‰€ä»¥ä¸­é—´å•†æ‹¿ä¸åˆ°æ­£ç¡®æ—¶åºçš„å®Œæ•´æ•°æ®ï¼Œæµé‡ç‰¹å¾ä¸å¥½ç¡®å®šã€‚å¦‚æœå®¶å®½æœ‰å¤šè·¯ ISP è¿˜å¯ä»¥åšå¸¦å®½èšåˆæ›´åŠ å®‰å…¨ã€‚"},{"user":{"login":"åœŸåŒªå¤§å“¥å“¥","avatar_url":"https://secure.gravatar.com/avatar/2c7f9543656ed24beddb3e3f0b1d02a4?d=retro"},"created_at":"2023-05-24T09:14:30Z","body":"æ–‡ä¸­çš„åè®®è¯´æ˜åœ¨å“ªé‡Œå‘¢ï¼Ÿé“¾æ¥è·³è¿‡å»æ²¡æœ‰äº†ï¼Ÿ"},{"user":{"login":"chika0801","avatar_url":"https://secure.gravatar.com/avatar/8781669f273f9fcde73a8879ed82337f?d=retro"},"created_at":"2023-06-08T08:55:50Z","body":"æ­å–œ 1.0.0 ç‰ˆæœ¬æ›´æ–°ï¼Œæ–°ç‰ˆæœ¬å¤ªå¿«äº†ï¼Œæ„Ÿè°¢ä½œè€…ï¼Œæ²¡æƒ³åˆ°ä½ åœ¨å›issæ—¶çš„ä¸€å¥ä¼šé‡æ„ï¼Œä¸€ç­‰åŠå¹´å¤šæ—¶é—´ï¼Œç»ˆäºåšå‡ºæ¥äº†ã€‚å†æ¬¡æ„Ÿè°¢ã€‚"},{"user":{"login":"aua","avatar_url":"https://secure.gravatar.com/avatar/?d=retro"},"created_at":"2022-12-06T10:34:26Z","body":"å½“è¿™ç±»é¡¹ç›®æ‹¥æœ‰ä¸€å®šçƒ­åº¦åï¼Œå¼€å‘è€…ä¸€å®šä¼šæˆä¸ºä¼—çŸ¢ä¹‹çš„\nä¸ºäº†å®‰å…¨è€ƒè™‘ä¹Ÿæ˜¯ä¸ºäº†è¿™ä¸ªé¡¹ç›®ï¼Œå»ºè®®ä½¿ç”¨æ–°è´¦å·ï¼ˆå‰²è£‚èº«ä»½ç›¸å…³ï¼‰ç­‰æ–¹å¼å»ç»´æŠ¤ã€æ›´æ–°ã€å‘å¸ƒTUICé¡¹ç›®å¹¶æ¸…é™¤èƒ½å¤Ÿæ˜ç¡®èº«ä»½ç›¸å…³çš„åšå®¢ç­‰å†…å®¹\nä¸€ä½†ç¬¬ä¸€ç»´æŠ¤è€…å€’ä¸‹åï¼ŒTUICå¾ˆå¯èƒ½å˜æˆå„ä¸ªå…‹éš†ä»“åº“å„è‡ªä¸ºé˜µçš„å±€é¢ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´å¤ªç—›è‹¦äº†ã€‚"},{"user":{"login":"ortt","avatar_url":"https://secure.gravatar.com/avatar/867ae57702dd9d4ebd40b2977e63497e?d=retro"},"created_at":"2023-02-23T12:38:24Z","body":"å¤šè°¢å¤§ä½¬"},{"user":{"login":"Senpai","avatar_url":"https://secure.gravatar.com/avatar/e4638187ba10c88590cfcfae42345bed?d=retro"},"created_at":"2022-11-28T07:20:59Z","body":"ä»ä½ å…¶ä»–æ–‡ç« æ¥çœ‹ï¼Œä¼¼ä¹è¿˜æ˜¯å¤§å­¦ç”Ÿã€‚ä¸æ€•è¢«å–èŒ¶å—"},{"user":{"login":"å‡¡å°˜","avatar_url":"https://secure.gravatar.com/avatar/60704096935c4f6f73bd6c7c862c4c2b?d=retro"},"created_at":"2022-03-24T22:53:29Z","body":"è¿™ä¸ªè¿˜æ˜¯å¾ˆæœ‰ç”¨çš„"},{"user":{"login":"Falcon55","avatar_url":"https://secure.gravatar.com/avatar/a53e0f259c78a55c07dac3ff88b83726?d=retro"},"created_at":"2022-11-29T09:43:37Z","body":"è¯·é—®åšä¸»æœ‰ä¸€äº›æ­å»ºæ•™ç¨‹ä¹ˆ å¤–è¡Œäººçœ‹äº†åŠå¤©æœ‰ç‚¹æä¸æ˜ç™½ è°¢è°¢"},{"user":{"login":"JL","avatar_url":"https://secure.gravatar.com/avatar/e7f4ba495d590ea37b927bf9a1a55626?d=retro"},"created_at":"2022-03-22T08:08:42Z","body":"è°¢è°¢åšä¸»ï¼\nå·²ç»ç”¨ä¸Šå•¦ï¼ä½†æ˜¯quicä¼šé‡åˆ°ä¸€äº›qosçš„é—®é¢˜ã€‚\nè¯·é—®å¤§ä½¬æœ‰å…´è¶£çœ‹ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®å˜›ï¼š\nhttps://github.com/Qv2ray/v2ray-rust\nå¸Œæœ›å…±åŒåŠªåŠ›ï¼ç¥å®‰å¥½ï¼"},{"user":{"login":"ken","avatar_url":"https://secure.gravatar.com/avatar/1e8d4626f39fbc932b0c15e2a2a36701?d=retro"},"created_at":"2023-02-10T13:12:00Z","body":"èƒ½å¦åœ¨æœåŠ¡å™¨ç«¯å¢åŠ sock5å‡ºå£è®¾ç½®ä»¥ä¾¿å¯¹æ¥*rayçš„routingåˆ†æµè®¾ç½®ï¼Ÿ"},{"user":{"login":"hhhhux","avatar_url":"https://secure.gravatar.com/avatar/4f1972d813fe58aa6e295fd4aee88220?d=retro"},"created_at":"2023-03-31T23:53:36Z","body":"ä½¬ç•™ä¸ªæèµ åœ°å€ï¼Œç»™ä½ ç‚¹åŠ¨åŠ›"},{"user":{"login":"æˆ‘æ˜¯æˆ‘","html_url":"http://www.902mix.co","avatar_url":"https://secure.gravatar.com/avatar/826409d4033fee2ffbc2adcae6d111f7?d=retro"},"created_at":"2022-11-18T21:33:17Z","body":"ä»“åº“é‡Œæ²¡æœ‰apkæ–‡ä»¶ ä¸‹è½½ä¸‹æ¥è‡ªå·±æ‰‹åŠ¨æ”¹å— è¿˜æ˜¯ï¼Ÿ"},{"user":{"login":"ğŸ˜‚â€¦â€¦","avatar_url":"https://secure.gravatar.com/avatar/c0b96917e374b46d9b4be632373c517d?d=retro"},"created_at":"2023-02-09T03:01:40Z","body":"> å¾ˆå¿« åœ¨ç§»åŠ¨ä¸‹ä¹Ÿæ²¡æœ‰qosé—®é¢˜ å§‹ç»ˆæ»¡é€Ÿ300mbps\n\nä¸çŸ¥é“æ–­æµé—®é¢˜æœ‰æ²¡æœ‰è§£å†³"},{"user":{"login":"molezz","html_url":"https://molezz.net","avatar_url":"https://secure.gravatar.com/avatar/f60a5fd549dbbee276b7bdabe22a2bff?d=retro"},"created_at":"2023-01-31T15:53:36Z","body":"å¾ˆå¿« åœ¨ç§»åŠ¨ä¸‹ä¹Ÿæ²¡æœ‰qosé—®é¢˜ å§‹ç»ˆæ»¡é€Ÿ300mbps"},{"user":{"login":"å˜¿å˜¿å˜¿","avatar_url":"https://secure.gravatar.com/avatar/0740791abe229e13d9438b582a57f176?d=retro"},"created_at":"2022-11-06T16:43:57Z","body":"ç”¨ä¸Šäº†ï¼Œå¾ˆå¥½ç”¨å•Šã€‚ç”¨çš„ç™½å«–çš„Azureçš„é¦™æ¸¯æœºï¼Œåœ¨å¹¿ä¸œæ™šé«˜å³°ç¨³å®šyoutubeåœ¨10ä¸‡å·¦å³ï¼Œæš‚æ—¶æ²¡æœ‰è¢«qosã€‚ç‚¹èµã€‚ç°åœ¨åœ¨æƒ³æ˜¯ä¸æ˜¯è¦éƒ¨ç½²ä¸ªç½‘ç«™ä¹‹ç±»çš„ã€‚ã€‚"},{"user":{"login":"Escher","html_url":"https://jkgblog.com","avatar_url":"https://secure.gravatar.com/avatar/731441c6ac9b290ab1c7423972dc6764?d=retro"},"created_at":"2022-03-24T01:42:00Z","body":"å·²ç»åœ¨ä½¿ç”¨ç€ï¼Œæ„Ÿè°¢å·¥å…·ï¼Œæˆ‘ä¼šåŠæ—¶issues"},{"user":{"login":"ä½šå","avatar_url":"https://secure.gravatar.com/avatar/9f5377a83fec2c41721f78189d209cab?d=retro"},"created_at":"2023-03-22T08:42:29Z","body":"gitä¸Šè¿ä¸ªé…ç½®æ¨¡æ¿éƒ½æ²¡æœ‰ä¹Ÿæ²¡æœ‰wikiã€‚ã€‚ã€‚"},{"user":{"login":"å˜»â†’å˜»â†˜å˜»â†—å˜»â†—å˜»â†˜","avatar_url":"https://secure.gravatar.com/avatar/bd918941db2e7c88bec4e27012d589e3?d=retro"},"created_at":"2023-02-12T13:51:32Z","body":"ç°åœ¨clientè¿˜æ˜¯ä¸èƒ½é•¿æ—¶é—´æŒ‚ç€è¿æ¥ï¼Œä¼šæ‰çº¿ï¼Œéœ€è¦å³ç”¨å³è¿ï¼Œä¸å¤ªæ–¹ä¾¿ã€‚"}]</div><style>#comment-header,#comment-list>li{margin:1em auto}#comment-avatar,#comment-tip{margin:auto .2em}#comment-action-avatar,#comment-avatar{width:1em;height:1em}#comment-action-info>*,#comment-action-input>*,#comment-info>*{display:inline-block;vertical-align:middle}#comment-header{font-size:1.6em;font-weight:700;line-height:1.6em}#comment-tip{font-style:italic}#comment-list{list-style:none;padding:0}#comment-action-author,#comment-author{font-weight:700;margin:auto .4em}#comment-datetime{font-size:.8em;font-style:italic}#comment-body{margin:auto 1.8em}#comment-action-info>*{margin:1em .2em}#comment-action-input{height:2em;width:100%;margin:1em auto}#comment-action-input>*{height:100%;margin:0 .2em}#comment-action-textarea{width:calc(100% - 8em)}#comment-action-post{width:6em}#comment-action-login{margin:1em .3em}</style><ol id=comment-list></ol><div id=comment-action></div><script>const y=e=>{var t=/\\([\\\|`*_{}\[\]()#+\-~])/g,n=/\n *&gt; *([^]*?)(?=(\n|$){2})/g,i=/\n( *)(?:[*\-+]|((\d+)|([a-z])|[A-Z])[.)]) +([^]*?)(?=(\n|$){2})/g,o=/(^|[^A-Za-z\d\\])(([*_])|(~)|(\^)|(--)|(\+\+)|`)(\2?)([^<]*?)\2\8(?!\2)(?=\W|_|$)/g,a=/^.*\n( *\|( *:?-+:?-+:? *\|)* *\n|)/,c=/.*\n/g,m=/\||(.*?[^\\])\|/g;const l=(t,n)=>{e=e.replace(t,n)},d=(e,t)=>"<"+e+">"+t+"</"+e+">",r=e=>e.replace(n,((e,t)=>d("blockquote",r(u(t.replace(/^ *&gt; */gm,"")))))),s=e=>e.replace(i,((e,t,n,i,o,a)=>(e=d("li",u(a.split(RegExp("\n ?"+t+"(?:(?:\\d+|[a-zA-Z])[.)]|[*\\-+]) +","g")).map(s).join("</li><li>"))),"\n"+(n?'<ol start="'+(i?n+'">':parseInt(n,36)-9+'" style="list-style-type:'+(o?"low":"upp")+'er-alpha">')+e+"</ol>":d("ul",e))))),u=e=>e.replace(o,((e,t,n,i,o,a,c,m,l,r)=>t+d(i?l?"strong":"em":o?l?"s":"sub":a?"sup":c?"small":m?"big":"code",u(r))));var p=[],h=0;return e="\n"+e+"\n",l(/</g,"&lt;"),l(/>/g,"&gt;"),l(/\t|\r|\uf8ff/g,"  "),e=r(e),l(/^([*\-=_] *){3,}$/gm,"<hr/>"),e=s(e),l(/<\/(ol|ul)>\n\n<\1>/g,""),l(/\n((```|~~~).*\n?([^]*?)\n?\2|((    .*?\n)+))/g,((e,t,n,i,o)=>(p[--h]=d("pre",d("code",i||o.replace(/^    /gm,""))),h+"ï£¿"))),l(/((!?)\[(.*?)\]\((.*?)( ".*")?\)|\\([\\`*_{}\[\]()#+\-.!~]))/g,((e,n,i,o,a,c,m)=>(p[--h]=a?i?'<img src="'+a+'" alt="'+o+'"/>':'<a href="'+a+'">'+u(o).replace(t,"$1")+"</a>":m,h+"ï£¿"))),l(/&lt;(.*?)&gt;/g,((e,n)=>'<a href="'+n+'">'+u(n).replace(t,"$1")+"</a>")),l(/\n(( *\|.*?\| *\n)+)/g,((e,n)=>{var i=n.match(a)[1];return"\n"+d("table",n.replace(c,((e,n)=>e==i?"":d("tr",e.replace(m,((e,o,a)=>a?d(i&&!n?"th":"td",u(o||"").replace(t,"$1")):""))))))})),l(/(?=^|>|\n)([>\s]*?)(#{1,6}) (.*?)( #*)? *(?=\n|$)/g,((e,n,i,o)=>n+d("h"+i.length,u(o).replace(t,"$1")))),l(/(?=^|>|\n)\s*\n+([^<]+?)\n+\s*(?=\n|<|$)/g,((e,n)=>d("p",u(n).replace(t,"$1")))),l(/-\d+\uf8ff/g,(e=>p[parseInt(e,10)])),e.trim()},f=e=>{let t=t=>e.next(t),n=t=>e.throw(t);return new Promise(((i,o)=>{let a=e=>{e.done?i(e.value):Promise.resolve(e.value).then(t,n).then(a,o)};a(e.next())}))};let g;const m=document.getElementById("comments-issue-id").innerText,n=new URL(window.location.href);let q,p=n.searchParams.get("github_access_token");p&&(document.cookie=`github_access_token=${p};Path=/;Secure;SameSite=Strict`,n.searchParams.delete("github_access_token"),window.location.replace(n)),null!=p||(p=null==(q=document.cookie.split(";").find((e=>e.trim().startsWith("github_access_token="))))?void 0:q.trim().substring(20));const r=()=>{document.cookie="github_access_token=;expires=Thu, 01 Jan 1970 00:00:00 GMT;Path=/;Secure;SameSite=Strict",p=null},t=()=>f(function*(){var e;let n;if(g=JSON.parse(null!=(n=null==(e=document.getElementById("comments-addition"))?void 0:e.innerText)?n:"[]"),p){if(200!==(e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"GET"})).status)return r(),yield t()}else e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}`,{method:"GET"});200===e.status&&(g=g.concat(yield e.json()))}()),u=()=>{g.sort(((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()));let e=document.getElementById("comment-list");e.innerHTML="";var t=document.createElement("div");for(t.id="comment-header",t.innerText="Comments",e.appendChild(t),0===g.length&&((t=document.createElement("div")).id="comment-tip",t.innerText="No comment yet",e.appendChild(t)),t=0;t<g.length;t++){let o=document.createElement("li");var n=document.createElement("div");n.id="comment-info";var i=document.createElement("img");i.id="comment-avatar",i.src=g[t].user.avatar_url,n.appendChild(i),(i=document.createElement("a")).id="comment-author",i.innerText=g[t].user.login,g[t].user.html_url&&(i.href=g[t].user.html_url),n.appendChild(i),(i=document.createElement("div")).id="comment-datetime",i.innerText=new Date(g[t].created_at).toLocaleString(),n.appendChild(i),o.appendChild(n),(n=document.createElement("div")).id="comment-body",n.innerHTML=y(g[t].body),o.appendChild(n),e.appendChild(o)}},v=()=>f(function*(){let e=document.getElementById("comment-action");e.innerHTML="";var n=document.createElement("div");if(n.id="comment-header",n.innerText="Leave a comment",e.appendChild(n),p){if(200===(n=yield fetch(`https://comments.eaimty.com/userinfo?github_access_token=${p}`,{method:"GET"})).status){n=yield n.json();let o=document.createElement("div");o.id="comment-action-info";var i=document.createElement("img");i.id="comment-action-avatar",i.src=n.avatar_url,o.appendChild(i),(i=document.createElement("a")).id="comment-action-author",i.innerText=n.login,i.href=n.html_url,o.appendChild(i);let a=document.createElement("button");a.id="comment-action-logout",a.innerText="Logout",a.addEventListener("click",(()=>{r(),v()})),o.appendChild(a),e.appendChild(o),(n=document.createElement("div")).id="comment-tip",n.innerText="Before commenting, please think about whether your comment is meaningful? Is it related to the topic? Is it rational and friendly? If you were someone else, would you feel uncomfortable seeing this comment?",e.appendChild(n),(n=document.createElement("div")).id="comment-action-input";let c=document.createElement("textarea");c.id="comment-action-textarea",c.placeholder="Leave a comment",n.appendChild(c);let l=document.createElement("button");return l.id="comment-action-post",l.innerText="Comment",l.addEventListener("click",(()=>f(function*(){a.disabled=!0,c.disabled=!0,l.disabled=!0;let e=c.value.trim();0!==e.length&&(201===(yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"POST",body:JSON.stringify({body:e})})).status?t().then((()=>u())).then((()=>v())):(r(),yield v(),window.alert("Failed to post comment")))}()))),n.appendChild(l),void e.appendChild(n)}r()}(n=document.createElement("div")).id="comment-tip",n.innerText="Clicking the login button means you agree to use cookies to store your GitHub Access Token",e.appendChild(n),(n=document.createElement("button")).id="comment-action-login",n.innerText="Login with GitHub",n.addEventListener("click",(()=>window.location.replace(`https://comments.eaimty.com/login?redirect_uri=${window.location.href}`))),e.appendChild(n)}());t().then((()=>u())).then((()=>v()))</script></div>