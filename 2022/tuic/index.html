<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=#000000 id=color_chrome name=theme-color><meta content=#000000 id=color_safari name=apple-mobile-web-app-status-bar-style><meta content="EAimTY's Blog" name=description><link rel="Shortcut Icon" href=https://www.eaimty.com/favicon.ico><link href=https://www.eaimty.com/favicon.ico rel=Bootmark><link title="EAimTY's Blog" href=https://www.eaimty.com/rss.xml rel=alternate type=application/rss+xml><style>#title,body{line-height:1.6em}body{background:#000;color:#00c000;font-size:1.2em}#container{margin:2.4em auto;width:72%}#header{text-align:center}#header>a{font-size:.96em;margin:auto 1em}#title{font-size:1.6em;font-weight:700;margin:1em auto}#date{font-style:italic}#list>li{margin:.8em auto;list-style:disc}img{max-width:100%}a{color:inherit;text-decoration:none}#content a,a:hover{text-decoration:underline}pre{padding:1em;overflow:auto;background:#1b1d16}:not(pre) >code{padding:.2em;background:#1b1d16;overflow:auto}blockquote{padding:0 1em;margin:0;border-left:.25em solid #212121}@media (max-width:600px){#container{width:88%}#header>a{margin:auto .3em}}</style><title>基于 QUIC 的代理软件：TUIC - EAimTY's Blog</title><body><div id=header><a href=https://www.eaimty.com>EAimTY's Blog</a><a href=https://www.eaimty.com/about/>About</a><a href=https://www.eaimty.com/friends/>Friends</a></div><div id=container><a href=https://www.eaimty.com/2022/tuic/ id=title>基于 QUIC 的代理软件：TUIC</a><div id=date>2022-03-10</div><div id=content><p>QUIC 协议汲取了大量人们给 TCP 糊墙的经验教训，把连接结构优化到（目前来看）极致。但是现在市面上的代理工具还没有能完全利用 QUIC 特性的存在，所以我自己动手写了一个基于 QUIC 协议的新代理工具：TUIC<p>https://github.com/EAimTY/tuic<ul><li>1-RTT TCP 中继<li>0-RTT UDP 中继，且 NAT 类型为 FullCone<li>在用户空间的拥塞控制，也就是说可以在任何系统平台实现双向的 BBR<li>两种 UDP 中继模式: native （原生 UDP 特性，数据仍被 TLS 加密）和 quic (100% 送达率，每个包单独单独作为一个 QUIC “流”，一个包的确认重传不会阻塞其它包)<li>完全多路复用，服务器和客户端之间始终只需要一条 QUIC 连接，所有任务作为这个连接中的 “流” 进行传输（一个流的暂时阻塞不会影响其它流），所以除连接第一个中继任务外的其它任务都不需要经过 QUIC 握手和 TUIC 的鉴权<li>网络切换时的会话平滑转移，例如在从 Wi-Fi 切换到移动数据时连接不会像 TCP 一样直接断开<li>0-RTT 、与中继任务并行的鉴权<li>支持 QUIC 的 0-RTT 握手（开启之后能达到 真・1-RTT TCP 和 0-RTT UDP ，但是就算不开启，多路复用的特性也能保证在绝大多数情况下 1-RTT 和 0-RTT ）</ul><p>TUIC 的设计介绍在仓库中 <a href=https://github.com/EAimTY/tuic#design>Design</a> 一节有说明。TUIC 协议的详细内容在<a href=https://github.com/EAimTY/tuic/tree/master/protocol>这里</a>。简单来说，TUIC 的设计核心就是减少握手造成的网络往返时延（ rtt ），毕竟对于网络程序这是最大的瓶颈。<p>对比其它使用 TCP 的代理工具（ ss 、v2ray 、trojan ），TCP 握手慢，且不支持自定义拥塞控制，各工具对 UDP 的支持也各有问题。对比 <a href=https://github.com/HyNetwork/hysteria>Hysteria</a> ，Hysteria 的 UDP 中继需要 1 rtt 的握手，且只支持一种 UDP 模式。<p>最后说说安全性和协议特征。TUIC 现在基于原生 QUIC ，不支持 obfs ，但 QUIC 连接本身就是 TLS 加密的，每个 QUIC 连接从外面看都是一样的。国内的各大厂也慢慢开始使用 QUIC 了，所以我觉得 QUIC 特征应该不是什么大问题。</div><div id=comments-issue-id style=display:none>51</div><div id=comments-addition style=display:none>[{"user":{"login":"est","html_url":"https://blog.est.im/","avatar_url":"https://secure.gravatar.com/avatar/a1e570c0195f7dfead850afe83a62d43?d=retro"},"created_at":"2022-11-12T00:26:21Z","body":"其实1根连接并不是什么好事呀。网络流量分析直接拿1个连接就能metadata 分析所有数据，其实最好的方式是M:N 连接。因为每一个网络包的路由都会稍微不同，所以中间商拿不到正确时序的完整数据，流量特征不好确定。如果家宽有多路 ISP 还可以做带宽聚合更加安全。"},{"user":{"login":"土匪大哥哥","avatar_url":"https://secure.gravatar.com/avatar/2c7f9543656ed24beddb3e3f0b1d02a4?d=retro"},"created_at":"2023-05-24T09:14:30Z","body":"文中的协议说明在哪里呢？链接跳过去没有了？"},{"user":{"login":"chika0801","avatar_url":"https://secure.gravatar.com/avatar/8781669f273f9fcde73a8879ed82337f?d=retro"},"created_at":"2023-06-08T08:55:50Z","body":"恭喜 1.0.0 版本更新，新版本太快了，感谢作者，没想到你在回iss时的一句会重构，一等半年多时间，终于做出来了。再次感谢。"},{"user":{"login":"aua","avatar_url":"https://secure.gravatar.com/avatar/?d=retro"},"created_at":"2022-12-06T10:34:26Z","body":"当这类项目拥有一定热度后，开发者一定会成为众矢之的\n为了安全考虑也是为了这个项目，建议使用新账号（割裂身份相关）等方式去维护、更新、发布TUIC项目并清除能够明确身份相关的博客等内容\n一但第一维护者倒下后，TUIC很可能变成各个克隆仓库各自为阵的局面，对于用户来说太痛苦了。"},{"user":{"login":"ortt","avatar_url":"https://secure.gravatar.com/avatar/867ae57702dd9d4ebd40b2977e63497e?d=retro"},"created_at":"2023-02-23T12:38:24Z","body":"多谢大佬"},{"user":{"login":"Senpai","avatar_url":"https://secure.gravatar.com/avatar/e4638187ba10c88590cfcfae42345bed?d=retro"},"created_at":"2022-11-28T07:20:59Z","body":"从你其他文章来看，似乎还是大学生。不怕被喝茶吗"},{"user":{"login":"凡尘","avatar_url":"https://secure.gravatar.com/avatar/60704096935c4f6f73bd6c7c862c4c2b?d=retro"},"created_at":"2022-03-24T22:53:29Z","body":"这个还是很有用的"},{"user":{"login":"Falcon55","avatar_url":"https://secure.gravatar.com/avatar/a53e0f259c78a55c07dac3ff88b83726?d=retro"},"created_at":"2022-11-29T09:43:37Z","body":"请问博主有一些搭建教程么 外行人看了半天有点搞不明白 谢谢"},{"user":{"login":"JL","avatar_url":"https://secure.gravatar.com/avatar/e7f4ba495d590ea37b927bf9a1a55626?d=retro"},"created_at":"2022-03-22T08:08:42Z","body":"谢谢博主！\n已经用上啦！但是quic会遇到一些qos的问题。\n请问大佬有兴趣看一下这个项目嘛：\nhttps://github.com/Qv2ray/v2ray-rust\n希望共同努力！祝安好！"},{"user":{"login":"ken","avatar_url":"https://secure.gravatar.com/avatar/1e8d4626f39fbc932b0c15e2a2a36701?d=retro"},"created_at":"2023-02-10T13:12:00Z","body":"能否在服务器端增加sock5出口设置以便对接*ray的routing分流设置？"},{"user":{"login":"hhhhux","avatar_url":"https://secure.gravatar.com/avatar/4f1972d813fe58aa6e295fd4aee88220?d=retro"},"created_at":"2023-03-31T23:53:36Z","body":"佬留个捐赠地址，给你点动力"},{"user":{"login":"我是我","html_url":"http://www.902mix.co","avatar_url":"https://secure.gravatar.com/avatar/826409d4033fee2ffbc2adcae6d111f7?d=retro"},"created_at":"2022-11-18T21:33:17Z","body":"仓库里没有apk文件 下载下来自己手动改吗 还是？"},{"user":{"login":"😂……","avatar_url":"https://secure.gravatar.com/avatar/c0b96917e374b46d9b4be632373c517d?d=retro"},"created_at":"2023-02-09T03:01:40Z","body":"> 很快 在移动下也没有qos问题 始终满速300mbps\n\n不知道断流问题有没有解决"},{"user":{"login":"molezz","html_url":"https://molezz.net","avatar_url":"https://secure.gravatar.com/avatar/f60a5fd549dbbee276b7bdabe22a2bff?d=retro"},"created_at":"2023-01-31T15:53:36Z","body":"很快 在移动下也没有qos问题 始终满速300mbps"},{"user":{"login":"嘿嘿嘿","avatar_url":"https://secure.gravatar.com/avatar/0740791abe229e13d9438b582a57f176?d=retro"},"created_at":"2022-11-06T16:43:57Z","body":"用上了，很好用啊。用的白嫖的Azure的香港机，在广东晚高峰稳定youtube在10万左右，暂时没有被qos。点赞。现在在想是不是要部署个网站之类的。。"},{"user":{"login":"Escher","html_url":"https://jkgblog.com","avatar_url":"https://secure.gravatar.com/avatar/731441c6ac9b290ab1c7423972dc6764?d=retro"},"created_at":"2022-03-24T01:42:00Z","body":"已经在使用着，感谢工具，我会及时issues"},{"user":{"login":"佚名","avatar_url":"https://secure.gravatar.com/avatar/9f5377a83fec2c41721f78189d209cab?d=retro"},"created_at":"2023-03-22T08:42:29Z","body":"git上连个配置模板都没有也没有wiki。。。"},{"user":{"login":"嘻→嘻↘嘻↗嘻↗嘻↘","avatar_url":"https://secure.gravatar.com/avatar/bd918941db2e7c88bec4e27012d589e3?d=retro"},"created_at":"2023-02-12T13:51:32Z","body":"现在client还是不能长时间挂着连接，会掉线，需要即用即连，不太方便。"}]</div><style>#comment-header,#comment-list>li{margin:1em auto}#comment-avatar,#comment-tip{margin:auto .2em}#comment-action-avatar,#comment-avatar{width:1em;height:1em}#comment-action-info>*,#comment-action-input>*,#comment-info>*{display:inline-block;vertical-align:middle}#comment-header{font-size:1.6em;font-weight:700;line-height:1.6em}#comment-tip{font-style:italic}#comment-list{list-style:none;padding:0}#comment-action-author,#comment-author{font-weight:700;margin:auto .4em}#comment-datetime{font-size:.8em;font-style:italic}#comment-body{margin:auto 1.8em}#comment-action-info>*{margin:1em .2em}#comment-action-input{height:2em;width:100%;margin:1em auto}#comment-action-input>*{height:100%;margin:0 .2em}#comment-action-textarea{width:calc(100% - 8em)}#comment-action-post{width:6em}#comment-action-login{margin:1em .3em}</style><ol id=comment-list></ol><div id=comment-action></div><script>const y=e=>{var t=/\\([\\\|`*_{}\[\]()#+\-~])/g,n=/\n *&gt; *([^]*?)(?=(\n|$){2})/g,i=/\n( *)(?:[*\-+]|((\d+)|([a-z])|[A-Z])[.)]) +([^]*?)(?=(\n|$){2})/g,o=/(^|[^A-Za-z\d\\])(([*_])|(~)|(\^)|(--)|(\+\+)|`)(\2?)([^<]*?)\2\8(?!\2)(?=\W|_|$)/g,a=/^.*\n( *\|( *:?-+:?-+:? *\|)* *\n|)/,c=/.*\n/g,m=/\||(.*?[^\\])\|/g;const l=(t,n)=>{e=e.replace(t,n)},d=(e,t)=>"<"+e+">"+t+"</"+e+">",r=e=>e.replace(n,((e,t)=>d("blockquote",r(u(t.replace(/^ *&gt; */gm,"")))))),s=e=>e.replace(i,((e,t,n,i,o,a)=>(e=d("li",u(a.split(RegExp("\n ?"+t+"(?:(?:\\d+|[a-zA-Z])[.)]|[*\\-+]) +","g")).map(s).join("</li><li>"))),"\n"+(n?'<ol start="'+(i?n+'">':parseInt(n,36)-9+'" style="list-style-type:'+(o?"low":"upp")+'er-alpha">')+e+"</ol>":d("ul",e))))),u=e=>e.replace(o,((e,t,n,i,o,a,c,m,l,r)=>t+d(i?l?"strong":"em":o?l?"s":"sub":a?"sup":c?"small":m?"big":"code",u(r))));var p=[],h=0;return e="\n"+e+"\n",l(/</g,"&lt;"),l(/>/g,"&gt;"),l(/\t|\r|\uf8ff/g,"  "),e=r(e),l(/^([*\-=_] *){3,}$/gm,"<hr/>"),e=s(e),l(/<\/(ol|ul)>\n\n<\1>/g,""),l(/\n((```|~~~).*\n?([^]*?)\n?\2|((    .*?\n)+))/g,((e,t,n,i,o)=>(p[--h]=d("pre",d("code",i||o.replace(/^    /gm,""))),h+""))),l(/((!?)\[(.*?)\]\((.*?)( ".*")?\)|\\([\\`*_{}\[\]()#+\-.!~]))/g,((e,n,i,o,a,c,m)=>(p[--h]=a?i?'<img src="'+a+'" alt="'+o+'"/>':'<a href="'+a+'">'+u(o).replace(t,"$1")+"</a>":m,h+""))),l(/&lt;(.*?)&gt;/g,((e,n)=>'<a href="'+n+'">'+u(n).replace(t,"$1")+"</a>")),l(/\n(( *\|.*?\| *\n)+)/g,((e,n)=>{var i=n.match(a)[1];return"\n"+d("table",n.replace(c,((e,n)=>e==i?"":d("tr",e.replace(m,((e,o,a)=>a?d(i&&!n?"th":"td",u(o||"").replace(t,"$1")):""))))))})),l(/(?=^|>|\n)([>\s]*?)(#{1,6}) (.*?)( #*)? *(?=\n|$)/g,((e,n,i,o)=>n+d("h"+i.length,u(o).replace(t,"$1")))),l(/(?=^|>|\n)\s*\n+([^<]+?)\n+\s*(?=\n|<|$)/g,((e,n)=>d("p",u(n).replace(t,"$1")))),l(/-\d+\uf8ff/g,(e=>p[parseInt(e,10)])),e.trim()},f=e=>{let t=t=>e.next(t),n=t=>e.throw(t);return new Promise(((i,o)=>{let a=e=>{e.done?i(e.value):Promise.resolve(e.value).then(t,n).then(a,o)};a(e.next())}))};let g;const m=document.getElementById("comments-issue-id").innerText,n=new URL(window.location.href);let q,p=n.searchParams.get("github_access_token");p&&(document.cookie=`github_access_token=${p};Path=/;Secure;SameSite=Strict`,n.searchParams.delete("github_access_token"),window.location.replace(n)),null!=p||(p=null==(q=document.cookie.split(";").find((e=>e.trim().startsWith("github_access_token="))))?void 0:q.trim().substring(20));const r=()=>{document.cookie="github_access_token=;expires=Thu, 01 Jan 1970 00:00:00 GMT;Path=/;Secure;SameSite=Strict",p=null},t=()=>f(function*(){var e;let n;if(g=JSON.parse(null!=(n=null==(e=document.getElementById("comments-addition"))?void 0:e.innerText)?n:"[]"),p){if(200!==(e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"GET"})).status)return r(),yield t()}else e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}`,{method:"GET"});200===e.status&&(g=g.concat(yield e.json()))}()),u=()=>{g.sort(((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()));let e=document.getElementById("comment-list");e.innerHTML="";var t=document.createElement("div");for(t.id="comment-header",t.innerText="Comments",e.appendChild(t),0===g.length&&((t=document.createElement("div")).id="comment-tip",t.innerText="No comment yet",e.appendChild(t)),t=0;t<g.length;t++){let o=document.createElement("li");var n=document.createElement("div");n.id="comment-info";var i=document.createElement("img");i.id="comment-avatar",i.src=g[t].user.avatar_url,n.appendChild(i),(i=document.createElement("a")).id="comment-author",i.innerText=g[t].user.login,g[t].user.html_url&&(i.href=g[t].user.html_url),n.appendChild(i),(i=document.createElement("div")).id="comment-datetime",i.innerText=new Date(g[t].created_at).toLocaleString(),n.appendChild(i),o.appendChild(n),(n=document.createElement("div")).id="comment-body",n.innerHTML=y(g[t].body),o.appendChild(n),e.appendChild(o)}},v=()=>f(function*(){let e=document.getElementById("comment-action");e.innerHTML="";var n=document.createElement("div");if(n.id="comment-header",n.innerText="Leave a comment",e.appendChild(n),p){if(200===(n=yield fetch(`https://comments.eaimty.com/userinfo?github_access_token=${p}`,{method:"GET"})).status){n=yield n.json();let o=document.createElement("div");o.id="comment-action-info";var i=document.createElement("img");i.id="comment-action-avatar",i.src=n.avatar_url,o.appendChild(i),(i=document.createElement("a")).id="comment-action-author",i.innerText=n.login,i.href=n.html_url,o.appendChild(i);let a=document.createElement("button");a.id="comment-action-logout",a.innerText="Logout",a.addEventListener("click",(()=>{r(),v()})),o.appendChild(a),e.appendChild(o),(n=document.createElement("div")).id="comment-tip",n.innerText="Before commenting, please think about whether your comment is meaningful? Is it related to the topic? Is it rational and friendly? If you were someone else, would you feel uncomfortable seeing this comment?",e.appendChild(n),(n=document.createElement("div")).id="comment-action-input";let c=document.createElement("textarea");c.id="comment-action-textarea",c.placeholder="Leave a comment",n.appendChild(c);let l=document.createElement("button");return l.id="comment-action-post",l.innerText="Comment",l.addEventListener("click",(()=>f(function*(){a.disabled=!0,c.disabled=!0,l.disabled=!0;let e=c.value.trim();0!==e.length&&(201===(yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"POST",body:JSON.stringify({body:e})})).status?t().then((()=>u())).then((()=>v())):(r(),yield v(),window.alert("Failed to post comment")))}()))),n.appendChild(l),void e.appendChild(n)}r()}(n=document.createElement("div")).id="comment-tip",n.innerText="Clicking the login button means you agree to use cookies to store your GitHub Access Token",e.appendChild(n),(n=document.createElement("button")).id="comment-action-login",n.innerText="Login with GitHub",n.addEventListener("click",(()=>window.location.replace(`https://comments.eaimty.com/login?redirect_uri=${window.location.href}`))),e.appendChild(n)}());t().then((()=>u())).then((()=>v()))</script></div>