<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=#000000 id=color_chrome name=theme-color><meta content=#000000 id=color_safari name=apple-mobile-web-app-status-bar-style><meta content="EAimTY's Blog" name=description><link rel="Shortcut Icon" href=https://www.eaimty.com/favicon.ico><link href=https://www.eaimty.com/favicon.ico rel=Bootmark><link title="EAimTY's Blog" href=https://www.eaimty.com/rss.xml rel=alternate type=application/rss+xml><style>#title,body{line-height:1.6em}body{background:#000;color:#00c000;font-size:1.2em}#container{margin:2.4em auto;width:72%}#header{text-align:center}#header>a{font-size:.96em;margin:auto 1em}#title{font-size:1.6em;font-weight:700;margin:1em auto}#date{font-style:italic}#list>li{margin:.8em auto;list-style:disc}img{max-width:100%}a{color:inherit;text-decoration:none}#content a,a:hover{text-decoration:underline}pre{padding:1em;overflow:auto;background:#1b1d16}:not(pre) >code{padding:.2em;background:#1b1d16;overflow:auto}blockquote{padding:0 1em;margin:0;border-left:.25em solid #212121}@media (max-width:600px){#container{width:88%}#header>a{margin:auto .3em}}</style><title>对 Linux 下触控板按键、加速和手势的优化（libinput） - EAimTY's Blog</title><body><div id=header><a href=https://www.eaimty.com>EAimTY's Blog</a><a href=https://www.eaimty.com/about/>About</a><a href=https://www.eaimty.com/friends/>Friends</a></div><div id=container><a href=https://www.eaimty.com/2020/optimize-touchpad-on-linux-with-libinput-driver/ id=title>对 Linux 下触控板按键、加速和手势的优化（libinput）</a><div id=date>2020-09-11</div><div id=content><p>我们都知道 macOS 下的触控板体验非常好，而 Windows 下的触控板体验最近几年靠着厂商的跟进和 Windows Precision Drivers 也进步了不少。其实在 Linux 的 Xorg 下想要达到类似的体验也非常简单。<p>Xorg 下经常用到的触控板驱动有 <a href=https://wiki.archlinux.org/index.php/Touchpad_Synaptics>Synaptics（已停止维护）</a>、<a href=https://wiki.archlinux.org/index.php/Libinput>libinput</a> 和 <a href=https://github.com/p2rkw/xf86-input-mtrack>mtrack</a>。这篇文章将会用 libinput 来优化改善触控板的按键、加速和手势设置。<h1 id=suo-xu-ruan-jian-bao>所需软件包</h1><p>首先需要的肯定是驱动本体，libinput 在各个发行版的官方仓库里都有打包，可以直接安装。<p>实现触控板手势需要 <a href=https://github.com/bulletmark/libinput-gestures>libinput-gestures</a>，直接编译安装， Arch 系可以直接用 AUR 安装。<p>（可选）可以安装 libinput-gestures 的 GUI 前端 <a href=https://gitlab.com/cunidev/gestures>gestures</a> 用来设置 libinput-gestures，但我认为实在没有必要，因为配置文件改起来也不难。<h1 id=hong-kong-ban-jia-su-yu-an-jian-she-zhi>触控板加速与按键设置</h1><p>首先查看 <code>/etc/X11/xorg.conf.d/</code> 下有没有已有的触控板配置文件，具体是看 Section 中是否有 <code>Identifier "touchpad"</code>。如果有就把这个 Section 删掉（最好先备份以防出问题）。 新建一个配置文件，优先级与文件名随意，如 <code>20-touchpad.conf</code>，内容如下：<pre><code>Section "InputClass"
    # 限定此配置文件只适用于触控板
    Identifier "touchpad"
    MatchIsTouchpad "on"

    # 设定驱动为 libinput
    Driver "libinput"

    # 在后面插入具体配置
    # ...

EndSection
</code></pre><p>之后在文件中填入需要的配置。<h2 id=ling-min-du-yu-shu-biao-jia-su>灵敏度与鼠标加速</h2><pre><code>    # 使用预设的触控板加速配置 2
    Option "AccelerationProfile" "2"

    # 设置灵敏度为 0.05
    Option "Sensitivity" "0.05"
</code></pre><p>如果用起来不顺手，你可以尝试调整 <code>"Sensitivity"</code> 的值，毕竟每个触控板的大小和素质都不同。<h2 id=qing-hong-ji-dian-ji>轻触即点击</h2><p>默认情况下 Xorg 不会将“轻点触控板”识别为点击，想要开启轻触即点击，加入：<pre><code>    Option "Tapping" "on"
</code></pre><h2 id=xiu-gai-dan-zhi-shuang-zhi-san-zhi-dui-ying-de-zuo-zhong-you-jian>修改单指、双指、三指对应的左、中、右键</h2><p>默认情况下 Xorg 会将单指视为左键、双指视为中键、三指视为右键，需要修改可以加入：<pre><code>    Option "TappingButtonMap" "lrm"
</code></pre><p>值中的 <code>l</code> 是 Left，<code>r</code> 是 Right，<code>m</code> 是 Mid，顺序为单、双、三指。<h2 id=fan-zhuan-hong-kong-ban-gun-dong-de-fang-xiang>反转触控板滚动的方向</h2><p>默认情况下 Xorg 的触控板滚动方向与 Windows 和 macOS 相反，觉得别扭可以开启“自然滚动”：<pre><code>    Option "NaturalScrolling" "on"
</code></pre><p>最终，我的配置文件 <code>20-touchpad.conf</code> 的内容是：<pre><code>Section "InputClass"
    Identifier "touchpad"
    MatchIsTouchpad "on"
    Driver "libinput"
    Option "AccelerationProfile" "2"
    Option "Sensitivity" "0.05"
    Option "Tapping" "on"
    Option "TappingButtonMap" "lrm"
    Option "NaturalScrolling" "on"
EndSection
</code></pre><h1 id=hong-kong-ban-shou-shi>触控板手势</h1><p>触控板手势最好配合WM的快捷键使用，例如将四指左右扫动绑定为 Ctrl+Right/Left，同时将 WM 的工作区切换也设置为同样的快捷键。 修改 libinput-gestures 的配置文件，<code>/etc/libinput-gestures.conf</code> 或是 <code>~/.config/libinput-gestures.conf</code>。<p>我的 <code>libinput-gestures.conf</code>：<pre><code># 识别阈值
swipe_threshold 0

# 切换工作区
gesture swipe left 4 xdotool key Ctrl+Right
gesture swipe right 4 xdotool key Ctrl+Left

# 切换窗口
gesture swipe left 3 xdotool key Alt+Right
gesture swipe right 3 xdotool key Alt+Left

# 显示/隐藏所有窗口
gesture swipe down 4 xdotool key Super+a

# 放大与缩小
gesture pinch in 2 xdotool key Ctrl+minus
gesture pinch out 2 xdotool key Ctrl+plus
</code></pre><p>最后启动 libinput-gestures，手势就会生效。<h1 id=kai-guan-hong-kong-ban>开关触控板</h1><p>在不用触控板时可以将其关掉。利用 <code>xinput enable/disable TOUCHPAD_ID</code> 可以开关触控板。<p>可以写一个脚本，执行就会开关触控板：<pre><code>#!/bin/bash
TOUCHPAD_ID=`xinput list | grep "Touchpad" | sed -n -e 's/^.*id=//p'|cut -f1`
if xinput list $TOUCHPAD_ID | grep -q 'This device is disabled'; then
xinput enable $TOUCHPAD_ID
else
xinput disable $TOUCHPAD_ID
fi
</code></pre><p>再绑定一个键盘快捷键，就可以轻松开关触控板了。 需要注意，这个脚本不会停止 libinput-gestures 识别触控板手势，如果要把手势同时禁用掉，就在脚本里分别加入启动、停止 libinput-gestures 的命令即可。</div><div id=comments-issue-id style=display:none>42</div><div id=comments-addition style=display:none>[{"user":{"login":"aiviciizhx","avatar_url":"https://secure.gravatar.com/avatar/f359ec637fed54bf737d0582c1240ed3?d=retro"},"created_at":"2022-03-29T05:54:45Z","body":"很好的一篇"},{"user":{"login":"Smile","avatar_url":"https://secure.gravatar.com/avatar/af05c093f9f4982f6ced97cff9feb5aa?d=retro"},"created_at":"2023-04-06T04:18:07Z","body":"配置文件目录应该是这个吧/usr/share/X11/xorg.conf.d"}]</div><style>#comment-header,#comment-list>li{margin:1em auto}#comment-avatar,#comment-tip{margin:auto .2em}#comment-action-avatar,#comment-avatar{width:1em;height:1em}#comment-action-info>*,#comment-action-input>*,#comment-info>*{display:inline-block;vertical-align:middle}#comment-header{font-size:1.6em;font-weight:700;line-height:1.6em}#comment-tip{font-style:italic}#comment-list{list-style:none;padding:0}#comment-action-author,#comment-author{font-weight:700;margin:auto .4em}#comment-datetime{font-size:.8em;font-style:italic}#comment-body{margin:auto 1.8em}#comment-action-info>*{margin:1em .2em}#comment-action-input{height:2em;width:100%;margin:1em auto}#comment-action-input>*{height:100%;margin:0 .2em}#comment-action-textarea{width:calc(100% - 8em)}#comment-action-post{width:6em}#comment-action-login{margin:1em .3em}</style><ol id=comment-list></ol><div id=comment-action></div><script>const y=e=>{var t=/\\([\\\|`*_{}\[\]()#+\-~])/g,n=/\n *&gt; *([^]*?)(?=(\n|$){2})/g,i=/\n( *)(?:[*\-+]|((\d+)|([a-z])|[A-Z])[.)]) +([^]*?)(?=(\n|$){2})/g,o=/(^|[^A-Za-z\d\\])(([*_])|(~)|(\^)|(--)|(\+\+)|`)(\2?)([^<]*?)\2\8(?!\2)(?=\W|_|$)/g,a=/^.*\n( *\|( *:?-+:?-+:? *\|)* *\n|)/,c=/.*\n/g,m=/\||(.*?[^\\])\|/g;const l=(t,n)=>{e=e.replace(t,n)},d=(e,t)=>"<"+e+">"+t+"</"+e+">",r=e=>e.replace(n,((e,t)=>d("blockquote",r(u(t.replace(/^ *&gt; */gm,"")))))),s=e=>e.replace(i,((e,t,n,i,o,a)=>(e=d("li",u(a.split(RegExp("\n ?"+t+"(?:(?:\\d+|[a-zA-Z])[.)]|[*\\-+]) +","g")).map(s).join("</li><li>"))),"\n"+(n?'<ol start="'+(i?n+'">':parseInt(n,36)-9+'" style="list-style-type:'+(o?"low":"upp")+'er-alpha">')+e+"</ol>":d("ul",e))))),u=e=>e.replace(o,((e,t,n,i,o,a,c,m,l,r)=>t+d(i?l?"strong":"em":o?l?"s":"sub":a?"sup":c?"small":m?"big":"code",u(r))));var p=[],h=0;return e="\n"+e+"\n",l(/</g,"&lt;"),l(/>/g,"&gt;"),l(/\t|\r|\uf8ff/g,"  "),e=r(e),l(/^([*\-=_] *){3,}$/gm,"<hr/>"),e=s(e),l(/<\/(ol|ul)>\n\n<\1>/g,""),l(/\n((```|~~~).*\n?([^]*?)\n?\2|((    .*?\n)+))/g,((e,t,n,i,o)=>(p[--h]=d("pre",d("code",i||o.replace(/^    /gm,""))),h+""))),l(/((!?)\[(.*?)\]\((.*?)( ".*")?\)|\\([\\`*_{}\[\]()#+\-.!~]))/g,((e,n,i,o,a,c,m)=>(p[--h]=a?i?'<img src="'+a+'" alt="'+o+'"/>':'<a href="'+a+'">'+u(o).replace(t,"$1")+"</a>":m,h+""))),l(/&lt;(.*?)&gt;/g,((e,n)=>'<a href="'+n+'">'+u(n).replace(t,"$1")+"</a>")),l(/\n(( *\|.*?\| *\n)+)/g,((e,n)=>{var i=n.match(a)[1];return"\n"+d("table",n.replace(c,((e,n)=>e==i?"":d("tr",e.replace(m,((e,o,a)=>a?d(i&&!n?"th":"td",u(o||"").replace(t,"$1")):""))))))})),l(/(?=^|>|\n)([>\s]*?)(#{1,6}) (.*?)( #*)? *(?=\n|$)/g,((e,n,i,o)=>n+d("h"+i.length,u(o).replace(t,"$1")))),l(/(?=^|>|\n)\s*\n+([^<]+?)\n+\s*(?=\n|<|$)/g,((e,n)=>d("p",u(n).replace(t,"$1")))),l(/-\d+\uf8ff/g,(e=>p[parseInt(e,10)])),e.trim()},f=e=>{let t=t=>e.next(t),n=t=>e.throw(t);return new Promise(((i,o)=>{let a=e=>{e.done?i(e.value):Promise.resolve(e.value).then(t,n).then(a,o)};a(e.next())}))};let g;const m=document.getElementById("comments-issue-id").innerText,n=new URL(window.location.href);let q,p=n.searchParams.get("github_access_token");p&&(document.cookie=`github_access_token=${p};Path=/;Secure;SameSite=Strict`,n.searchParams.delete("github_access_token"),window.location.replace(n)),null!=p||(p=null==(q=document.cookie.split(";").find((e=>e.trim().startsWith("github_access_token="))))?void 0:q.trim().substring(20));const r=()=>{document.cookie="github_access_token=;expires=Thu, 01 Jan 1970 00:00:00 GMT;Path=/;Secure;SameSite=Strict",p=null},t=()=>f(function*(){var e;let n;if(g=JSON.parse(null!=(n=null==(e=document.getElementById("comments-addition"))?void 0:e.innerText)?n:"[]"),p){if(200!==(e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"GET"})).status)return r(),yield t()}else e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}`,{method:"GET"});200===e.status&&(g=g.concat(yield e.json()))}()),u=()=>{g.sort(((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()));let e=document.getElementById("comment-list");e.innerHTML="";var t=document.createElement("div");for(t.id="comment-header",t.innerText="Comments",e.appendChild(t),0===g.length&&((t=document.createElement("div")).id="comment-tip",t.innerText="No comment yet",e.appendChild(t)),t=0;t<g.length;t++){let o=document.createElement("li");var n=document.createElement("div");n.id="comment-info";var i=document.createElement("img");i.id="comment-avatar",i.src=g[t].user.avatar_url,n.appendChild(i),(i=document.createElement("a")).id="comment-author",i.innerText=g[t].user.login,g[t].user.html_url&&(i.href=g[t].user.html_url),n.appendChild(i),(i=document.createElement("div")).id="comment-datetime",i.innerText=new Date(g[t].created_at).toLocaleString(),n.appendChild(i),o.appendChild(n),(n=document.createElement("div")).id="comment-body",n.innerHTML=y(g[t].body),o.appendChild(n),e.appendChild(o)}},v=()=>f(function*(){let e=document.getElementById("comment-action");e.innerHTML="";var n=document.createElement("div");if(n.id="comment-header",n.innerText="Leave a comment",e.appendChild(n),p){if(200===(n=yield fetch(`https://comments.eaimty.com/userinfo?github_access_token=${p}`,{method:"GET"})).status){n=yield n.json();let o=document.createElement("div");o.id="comment-action-info";var i=document.createElement("img");i.id="comment-action-avatar",i.src=n.avatar_url,o.appendChild(i),(i=document.createElement("a")).id="comment-action-author",i.innerText=n.login,i.href=n.html_url,o.appendChild(i);let a=document.createElement("button");a.id="comment-action-logout",a.innerText="Logout",a.addEventListener("click",(()=>{r(),v()})),o.appendChild(a),e.appendChild(o),(n=document.createElement("div")).id="comment-tip",n.innerText="Before commenting, please think about whether your comment is meaningful? Is it related to the topic? Is it rational and friendly? If you were someone else, would you feel uncomfortable seeing this comment?",e.appendChild(n),(n=document.createElement("div")).id="comment-action-input";let c=document.createElement("textarea");c.id="comment-action-textarea",c.placeholder="Leave a comment",n.appendChild(c);let l=document.createElement("button");return l.id="comment-action-post",l.innerText="Comment",l.addEventListener("click",(()=>f(function*(){a.disabled=!0,c.disabled=!0,l.disabled=!0;let e=c.value.trim();0!==e.length&&(201===(yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"POST",body:JSON.stringify({body:e})})).status?t().then((()=>u())).then((()=>v())):(r(),yield v(),window.alert("Failed to post comment")))}()))),n.appendChild(l),void e.appendChild(n)}r()}(n=document.createElement("div")).id="comment-tip",n.innerText="Clicking the login button means you agree to use cookies to store your GitHub Access Token",e.appendChild(n),(n=document.createElement("button")).id="comment-action-login",n.innerText="Login with GitHub",n.addEventListener("click",(()=>window.location.replace(`https://comments.eaimty.com/login?redirect_uri=${window.location.href}`))),e.appendChild(n)}());t().then((()=>u())).then((()=>v()))</script></div>