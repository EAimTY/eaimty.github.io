<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=#000000 id=color_chrome name=theme-color><meta content=#000000 id=color_safari name=apple-mobile-web-app-status-bar-style><meta content="EAimTY's Blog" name=description><link rel="Shortcut Icon" href=https://www.eaimty.com/favicon.ico><link href=https://www.eaimty.com/favicon.ico rel=Bootmark><link title="EAimTY's Blog" href=https://www.eaimty.com/rss.xml rel=alternate type=application/rss+xml><style>#title,body{line-height:1.6em}body{background:#000;color:#00c000;font-size:1.2em}#container{margin:2.4em auto;width:72%}#header{text-align:center}#header>a{font-size:.96em;margin:auto 1em}#title{font-size:1.6em;font-weight:700;margin:1em auto}#date{font-style:italic}#list>li{margin:.8em auto;list-style:disc}img{max-width:100%}a{color:inherit;text-decoration:none}#content a,a:hover{text-decoration:underline}pre{padding:1em;overflow:auto;background:#1b1d16}:not(pre) >code{padding:.2em;background:#1b1d16;overflow:auto}blockquote{padding:0 1em;margin:0;border-left:.25em solid #212121}@media (max-width:600px){#container{width:88%}#header>a{margin:auto .3em}}</style><title>è®°å½•ä¸€ä¸‹é‡è£…æœåŠ¡å™¨ç³»ç»Ÿä¸­é‡åˆ°çš„ä¸€å †å‘ - EAimTY's Blog</title><body><div id=header><a href=https://www.eaimty.com>EAimTY's Blog</a><a href=https://www.eaimty.com/about/>About</a><a href=https://www.eaimty.com/friends/>Friends</a></div><div id=container><a href=https://www.eaimty.com/2017/traps-in-server-system-reconfiguration/ id=title>è®°å½•ä¸€ä¸‹é‡è£…æœåŠ¡å™¨ç³»ç»Ÿä¸­é‡åˆ°çš„ä¸€å †å‘</a><div id=date>2017-08-08</div><div id=content><p>å¾ˆé•¿ä¸€æ®µæ—¶é—´ä»¥æ¥ï¼Œåšä¸»ç”¨çš„ <a href="https://www.vultr.com/?ref=7131872">Vultr</a> 2.5 åˆ€å°æœºä¸Šçš„ MySQL 5.7 é¢‘ç¹æŠ½é£ï¼Œç»å¸¸éœ€è¦æ‰‹åŠ¨é‡å¯æœåŠ¡å™¨ï¼Œè‡³äºä¸ºä»€ä¹ˆè¿™ä¹ˆé•¿æ—¶é—´æ²¡æœ‰ç®¡å®ƒï¼ŒåŸå› è¿˜æ˜¯æˆ‘æ‡’å‘—~<p>æœ€è¿‘é—²äº†ä¸‹æ¥ï¼Œæœ‰æ—¶é—´æŠ˜è…¾ä¸€ä¸‹æœåŠ¡å™¨äº†ï¼Œäºæ˜¯é‡è£…äº†ä¸€ä¸‹æ¢å› MySQL 5.5ï¼Œç”¨ CentOS å®˜æ–¹é•œåƒé‡è£…äº†ç³»ç»Ÿã€‚ ä¹‹å‰å› ä¸ºå¬è¯´ SELinux å’Œ Systemd ä¹‹é—´ä¸å®¹æ˜“å’Œè°å…±å¤„ï¼Œæ‰€ä»¥éƒ½æ˜¯å…³æ‰ SELinux çš„ï¼ˆä¸è¦å­¦æˆ‘ï¼Œè¿™å¾ˆä¸å®‰å…¨ï¼‰ã€‚ è¿™æ¬¡ç”¨ CentOS7 1611 x64 Minimal å®˜æ–¹é•œåƒä¸­ SELinux æ˜¯é»˜è®¤æ‰“å¼€çš„ï¼Œè¯•äº†ä¸€ä¸‹ï¼Œå‘ç°ä¸æ˜¯æƒ³è±¡ä¸­çš„é‚£ä¹ˆå·®ï¼Œæ‰€ä»¥å°±æ²¡æœ‰å…³é—­ã€‚ æ¥ä¸‹æ¥ï¼Œå‘å°±æ¥äº†ã€‚<h1 id=keng-yi>å‘ä¸€</h1><p>æ›´æ¢ SSH ç«¯å£åï¼Œä»å¤–ç•Œæ— æ³•è¿æ¥<h2 id=jie-jue-fang-fa>è§£å†³æ–¹æ³•ï¼š</h2><p>æ ¹æ® sshd_config ä¸­ç»™å‡ºçš„æ–¹æ³•ï¼Œåœ¨æ–‡ä»¶ä¸­ä¿®æ”¹ç«¯å£å·åéœ€è¦å‘Šè¯‰ SELinuxï¼Œè¿è¡Œ <code># semanage port -a -t ssh_port_t -p tcp ç«¯å£å·</code><h1 id=keng-er>å‘äºŒ</h1><p>semanage command not found<h2 id=jie-jue-fang-fa-1>è§£å†³æ–¹æ³•</h2><p>æŸ¥ä¸€ä¸‹å‘½ä»¤æ‰€åœ¨åŒ…ï¼š<code># yum provides semanage</code><p>å¾—çŸ¥å‘½ä»¤å­˜åœ¨äºåŒ… <code>policycoreutils-python</code><p>å®‰è£…åŒ…ï¼š<code># yum install policycoreutils-python</code><h1 id=keng-san>å‘ä¸‰</h1><p>nginx è¯»ä¸åˆ°é…ç½®æ–‡ä»¶ã€è¯ä¹¦ï¼Œç½‘ç«™ç›®å½•<h2 id=jie-jue-fang-fa-2>è§£å†³æ–¹æ³•</h2><p>SELinux æœ‰ä¸ªé™åˆ¶ï¼šcp instead mv<p>åœ¨æŠ˜è…¾å¥½æ–‡ä»¶åï¼Œæ‰§è¡Œ <code># restorecon -v -R /path/to/files</code><h1 id=keng-si>å‘å››</h1><p>ç½‘ç«™ confã€è¯ä¹¦ã€æ–‡ä»¶éƒ½åˆ°ä½åè®¿é—®æ˜¾ç¤º <code>files not exist</code><h2 id=jie-jue-fang-fa-3>è§£å†³æ–¹æ³•</h2><p>è¿˜æ˜¯ SELinux çš„é”…<p>å‘Šè¯‰ SELinux è¿™æ˜¯ç½‘ç«™çš„æ–‡ä»¶ï¼š<code># chcon -Rt httpd_sys_content_t /path/to/www</code> å¦‚éœ€é€šè¿‡ç½‘é¡µç¨‹åºä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼Œåˆ™æ˜¯ï¼š<code># chcon -Rt httpd_sys_content_rw_t /path/to/writabledir</code><h1 id=keng-wu>å‘äº”</h1><p>å¯é€šè¿‡ ip ç›´æ¥ç»è¿‡ 443 ç«¯å£è®¿é—®ç½‘ç«™<h2 id=jie-jue-fang-fa-4>è§£å†³æ–¹æ³•</h2><p>æˆ‘çš„ç«™ç‚¹éƒ½æ˜¯æœ‰ SSL çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½ä¼šåœ¨ iptables ä¸­ç¦æ‰ 80 ç«¯å£ï¼Œæ‰€ä»¥å’±ä»¬åªéœ€è¦æŠ˜è…¾ä¸€ä¸‹ 443 ç«¯å£çš„é—®é¢˜ Google åˆ°çš„ç»“æœä¸­æœ‰ä¸€å †æ”¾åœ¨ CSDNã€åšå®¢å›­ä¹‹ç±»çš„æ–‡ç« ï¼Œä½ æŠ„æˆ‘ï¼Œæˆ‘æŠ„ä½ ï¼Œè€Œä¸”æŠ„çš„è¿˜éƒ½æœ‰é—®é¢˜ï¼ŒçœŸ TM æ˜¯æ¶å¿ƒé€äº†ã€‚<p>æœ€ç»ˆæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼š<p>åœ¨ nginx.conf ä¸­çš„ <code>include /etc/nginx/conf.d/*.conf;</code> ä¸€è¡Œä¸‹é¢æ’å…¥ï¼š<pre class=language-conf data-lang=conf><code class=language-conf data-lang=conf>server {
    listen  443 default;
    return  444;
    ssl_certificate /path/to/crt;
    ssl_certificate_key /path/to/key;
}
</code></pre><p>è¿™é‡Œçš„è¯ä¹¦è‡ªå·±ç­¾ä¸€ä¸ªå°±å¥½ï¼Œæ³¨æ„ä¸è¦åœ¨å…¶ä¸­æ³„éœ²çœŸæ˜¯çš„ç½‘ç«™ä¿¡æ¯ã€‚</div><div id=comments-issue-id style=display:none>22</div><div id=comments-addition style=display:none>[{"user":{"login":"RVIER","avatar_url":"https://secure.gravatar.com/avatar/6034259ba3ddea6565f63320769f5132?d=retro"},"created_at":"2017-10-14T09:26:49Z","body":"> ğŸ˜‚SELinuxï¼ŒèƒŒé”…ä¾ \n\nâ€œä½ æŠ„æˆ‘ï¼Œæˆ‘æŠ„ä½ ï¼Œè€Œä¸”æŠ„çš„è¿˜éƒ½æœ‰é—®é¢˜â€ å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå—å„¿"},{"user":{"login":"Benny","html_url":"https://www.bennythink.com","avatar_url":"https://secure.gravatar.com/avatar/38a94d1b56f913b2531ab3a36577d3e4?d=retro"},"created_at":"2017-08-09T07:19:51Z","body":"ğŸ˜‚SELinuxï¼ŒèƒŒé”…ä¾ "}]</div><style>#comment-header,#comment-list>li{margin:1em auto}#comment-avatar,#comment-tip{margin:auto .2em}#comment-action-avatar,#comment-avatar{width:1em;height:1em}#comment-action-info>*,#comment-action-input>*,#comment-info>*{display:inline-block;vertical-align:middle}#comment-header{font-size:1.6em;font-weight:700;line-height:1.6em}#comment-tip{font-style:italic}#comment-list{list-style:none;padding:0}#comment-action-author,#comment-author{font-weight:700;margin:auto .4em}#comment-datetime{font-size:.8em;font-style:italic}#comment-body{margin:auto 1.8em}#comment-action-info>*{margin:1em .2em}#comment-action-input{height:2em;width:100%;margin:1em auto}#comment-action-input>*{height:100%;margin:0 .2em}#comment-action-textarea{width:calc(100% - 8em)}#comment-action-post{width:6em}#comment-action-login{margin:1em .3em}</style><ol id=comment-list></ol><div id=comment-action></div><script>const y=e=>{var t=/\\([\\\|`*_{}\[\]()#+\-~])/g,n=/\n *&gt; *([^]*?)(?=(\n|$){2})/g,i=/\n( *)(?:[*\-+]|((\d+)|([a-z])|[A-Z])[.)]) +([^]*?)(?=(\n|$){2})/g,o=/(^|[^A-Za-z\d\\])(([*_])|(~)|(\^)|(--)|(\+\+)|`)(\2?)([^<]*?)\2\8(?!\2)(?=\W|_|$)/g,a=/^.*\n( *\|( *:?-+:?-+:? *\|)* *\n|)/,c=/.*\n/g,m=/\||(.*?[^\\])\|/g;const l=(t,n)=>{e=e.replace(t,n)},d=(e,t)=>"<"+e+">"+t+"</"+e+">",r=e=>e.replace(n,((e,t)=>d("blockquote",r(u(t.replace(/^ *&gt; */gm,"")))))),s=e=>e.replace(i,((e,t,n,i,o,a)=>(e=d("li",u(a.split(RegExp("\n ?"+t+"(?:(?:\\d+|[a-zA-Z])[.)]|[*\\-+]) +","g")).map(s).join("</li><li>"))),"\n"+(n?'<ol start="'+(i?n+'">':parseInt(n,36)-9+'" style="list-style-type:'+(o?"low":"upp")+'er-alpha">')+e+"</ol>":d("ul",e))))),u=e=>e.replace(o,((e,t,n,i,o,a,c,m,l,r)=>t+d(i?l?"strong":"em":o?l?"s":"sub":a?"sup":c?"small":m?"big":"code",u(r))));var p=[],h=0;return e="\n"+e+"\n",l(/</g,"&lt;"),l(/>/g,"&gt;"),l(/\t|\r|\uf8ff/g,"  "),e=r(e),l(/^([*\-=_] *){3,}$/gm,"<hr/>"),e=s(e),l(/<\/(ol|ul)>\n\n<\1>/g,""),l(/\n((```|~~~).*\n?([^]*?)\n?\2|((    .*?\n)+))/g,((e,t,n,i,o)=>(p[--h]=d("pre",d("code",i||o.replace(/^    /gm,""))),h+"ï£¿"))),l(/((!?)\[(.*?)\]\((.*?)( ".*")?\)|\\([\\`*_{}\[\]()#+\-.!~]))/g,((e,n,i,o,a,c,m)=>(p[--h]=a?i?'<img src="'+a+'" alt="'+o+'"/>':'<a href="'+a+'">'+u(o).replace(t,"$1")+"</a>":m,h+"ï£¿"))),l(/&lt;(.*?)&gt;/g,((e,n)=>'<a href="'+n+'">'+u(n).replace(t,"$1")+"</a>")),l(/\n(( *\|.*?\| *\n)+)/g,((e,n)=>{var i=n.match(a)[1];return"\n"+d("table",n.replace(c,((e,n)=>e==i?"":d("tr",e.replace(m,((e,o,a)=>a?d(i&&!n?"th":"td",u(o||"").replace(t,"$1")):""))))))})),l(/(?=^|>|\n)([>\s]*?)(#{1,6}) (.*?)( #*)? *(?=\n|$)/g,((e,n,i,o)=>n+d("h"+i.length,u(o).replace(t,"$1")))),l(/(?=^|>|\n)\s*\n+([^<]+?)\n+\s*(?=\n|<|$)/g,((e,n)=>d("p",u(n).replace(t,"$1")))),l(/-\d+\uf8ff/g,(e=>p[parseInt(e,10)])),e.trim()},f=e=>{let t=t=>e.next(t),n=t=>e.throw(t);return new Promise(((i,o)=>{let a=e=>{e.done?i(e.value):Promise.resolve(e.value).then(t,n).then(a,o)};a(e.next())}))};let g;const m=document.getElementById("comments-issue-id").innerText,n=new URL(window.location.href);let q,p=n.searchParams.get("github_access_token");p&&(document.cookie=`github_access_token=${p};Path=/;Secure;SameSite=Strict`,n.searchParams.delete("github_access_token"),window.location.replace(n)),null!=p||(p=null==(q=document.cookie.split(";").find((e=>e.trim().startsWith("github_access_token="))))?void 0:q.trim().substring(20));const r=()=>{document.cookie="github_access_token=;expires=Thu, 01 Jan 1970 00:00:00 GMT;Path=/;Secure;SameSite=Strict",p=null},t=()=>f(function*(){var e;let n;if(g=JSON.parse(null!=(n=null==(e=document.getElementById("comments-addition"))?void 0:e.innerText)?n:"[]"),p){if(200!==(e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"GET"})).status)return r(),yield t()}else e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}`,{method:"GET"});200===e.status&&(g=g.concat(yield e.json()))}()),u=()=>{g.sort(((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()));let e=document.getElementById("comment-list");e.innerHTML="";var t=document.createElement("div");for(t.id="comment-header",t.innerText="Comments",e.appendChild(t),0===g.length&&((t=document.createElement("div")).id="comment-tip",t.innerText="No comment yet",e.appendChild(t)),t=0;t<g.length;t++){let o=document.createElement("li");var n=document.createElement("div");n.id="comment-info";var i=document.createElement("img");i.id="comment-avatar",i.src=g[t].user.avatar_url,n.appendChild(i),(i=document.createElement("a")).id="comment-author",i.innerText=g[t].user.login,g[t].user.html_url&&(i.href=g[t].user.html_url),n.appendChild(i),(i=document.createElement("div")).id="comment-datetime",i.innerText=new Date(g[t].created_at).toLocaleString(),n.appendChild(i),o.appendChild(n),(n=document.createElement("div")).id="comment-body",n.innerHTML=y(g[t].body),o.appendChild(n),e.appendChild(o)}},v=()=>f(function*(){let e=document.getElementById("comment-action");e.innerHTML="";var n=document.createElement("div");if(n.id="comment-header",n.innerText="Leave a comment",e.appendChild(n),p){if(200===(n=yield fetch(`https://comments.eaimty.com/userinfo?github_access_token=${p}`,{method:"GET"})).status){n=yield n.json();let o=document.createElement("div");o.id="comment-action-info";var i=document.createElement("img");i.id="comment-action-avatar",i.src=n.avatar_url,o.appendChild(i),(i=document.createElement("a")).id="comment-action-author",i.innerText=n.login,i.href=n.html_url,o.appendChild(i);let a=document.createElement("button");a.id="comment-action-logout",a.innerText="Logout",a.addEventListener("click",(()=>{r(),v()})),o.appendChild(a),e.appendChild(o),(n=document.createElement("div")).id="comment-tip",n.innerText="Before commenting, please think about whether your comment is meaningful? Is it related to the topic? Is it rational and friendly? If you were someone else, would you feel uncomfortable seeing this comment?",e.appendChild(n),(n=document.createElement("div")).id="comment-action-input";let c=document.createElement("textarea");c.id="comment-action-textarea",c.placeholder="Leave a comment",n.appendChild(c);let l=document.createElement("button");return l.id="comment-action-post",l.innerText="Comment",l.addEventListener("click",(()=>f(function*(){a.disabled=!0,c.disabled=!0,l.disabled=!0;let e=c.value.trim();0!==e.length&&(201===(yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"POST",body:JSON.stringify({body:e})})).status?t().then((()=>u())).then((()=>v())):(r(),yield v(),window.alert("Failed to post comment")))}()))),n.appendChild(l),void e.appendChild(n)}r()}(n=document.createElement("div")).id="comment-tip",n.innerText="Clicking the login button means you agree to use cookies to store your GitHub Access Token",e.appendChild(n),(n=document.createElement("button")).id="comment-action-login",n.innerText="Login with GitHub",n.addEventListener("click",(()=>window.location.replace(`https://comments.eaimty.com/login?redirect_uri=${window.location.href}`))),e.appendChild(n)}());t().then((()=>u())).then((()=>v()))</script></div>