<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=#000000 id=color_chrome name=theme-color><meta content=#000000 id=color_safari name=apple-mobile-web-app-status-bar-style><meta content="EAimTY's Blog" name=description><link rel="Shortcut Icon" href=https://www.eaimty.com/favicon.ico><link href=https://www.eaimty.com/favicon.ico rel=Bootmark><link title="EAimTY's Blog" href=https://www.eaimty.com/rss.xml rel=alternate type=application/rss+xml><style>#title,body{line-height:1.6em}body{background:#000;color:#00c000;font-size:1.2em}#container{margin:2.4em auto;width:72%}#header{text-align:center}#header>a{font-size:.96em;margin:auto 1em}#title{font-size:1.6em;font-weight:700;margin:1em auto}#date{font-style:italic}#list>li{margin:.8em auto;list-style:disc}img{max-width:100%}a{color:inherit;text-decoration:none}#content a,a:hover{text-decoration:underline}pre{padding:1em;overflow:auto;background:#1b1d16}:not(pre) >code{padding:.2em;background:#1b1d16;overflow:auto}blockquote{padding:0 1em;margin:0;border-left:.25em solid #212121}@media (max-width:600px){#container{width:88%}#header>a{margin:auto .3em}}</style><title>用 900 元组装一台 CPU 算力（较）强劲的工作站 - EAimTY's Blog</title><body><div id=header><a href=https://www.eaimty.com>EAimTY's Blog</a><a href=https://www.eaimty.com/about/>About</a><a href=https://www.eaimty.com/friends/>Friends</a></div><div id=container><a href=https://www.eaimty.com/2017/budget-workstation-with-powerful-cpu/ id=title>用 900 元组装一台 CPU 算力（较）强劲的工作站</a><div id=date>2017-07-23</div><div id=content><p>距离上次发文已经相隔 4 个月了，消失了这么长时间，其实我是~~跑去搞大新闻了~~。<h1 id=yong-900-yuan-zu-zhuang-yi-tai-cpu-suan-li-jiao-qiang-jing-de-gong-zuo-zhan-xu-yao-shi-yao>用 900 元组装一台 CPU 算力（较）强劲的工作站需要什么？</h1><ul><li><del>充足的想象力</del><li><del>快如闪电的手速（用于在闲鱼刷新淘件）</del><li><del>嘴炮（用于砍价）</del></ul><h1 id=pei-zhi-dan>配置单</h1><h2 id=jia-gou>架构</h2><p>首先选择架构。<p>既然想用不到千元来组装机器，那么选择最新的架构肯定是行不通的。纵观整个市场，想要尽量节省且得到较强的性能，需要注意如下几点：<ol><li>使用服务器架构<li>不要入农企的坑（原因显而易见，一是性能差、性价比低（他家的 U 没一个能打的，况且 x86 还要分大小核？我吐了），二是不可靠（三核 CPU 是哪儿来的？）<li>不使用 3-5 年内的新架构，要等主流市场完全退烧后再入<li>因为用到的是老 CPU，核心、线程越多越好。</ol><p>综上，我最终选择了英特尔在 2010 年左右发布的 1366 架构，性价比极高！<h2 id=cpu>CPU</h2><p>1366 架构的所有 CPU 中，性价比最高的当属 X5650（<a href=https://ark.intel.com/products/47922/Intel-Xeon-Processor-X5650-12M-Cache-2_66-GHz-6_40-GTs-Intel-QPI>它的 Intel Ark</a>） 在 X5650 发布时，正赶上了 32nm 的东风，因此 能耗比相较于至强 55xx 系列出色很多。在 56xx 系列中，E 和 L 系列性能较低，而比 X5650 高端的 X5670 和 X5690 又太贵，一块就要四五百。<p>6 核 12 线程，基频 2.66 GHz，Boost 频率 3.0GHz，12M 缓存，95W TDP，在 CPU 天梯图中与 i5-4670K 打了平手，可见其性能也比较高了。 淘宝 120 元一块，来两块！总共是暴力的 12 核 24 线程！<p><img alt=CPU src=/pictures/5975d41a2d4ef.png><h2 id=zhu-ban>主板</h2><p>x58 的服务器板子，现在存世量不算太多。 由于 1366 架构支持的是至强 55xx/56xx 系列与初代酷睿 i7 至尊系列，所以我们有以下选择：<ul><li>睾贵的 ASUS 之类大厂的民用板，当年被用来配合初代 i7 至尊版，是最高端的民用、工作站产品之一，贵出天际，现在也没便宜到哪里去，闲鱼上均价要五百块左右<li>寨板。各种各样的小厂为二手 DIY 市场出了不少 x58 板子，主要是被用来配合降价的至强系列，然而毕竟是小厂，并不是很可靠<li>企业级服务器市场的产品，代表有惠普的 DL 系列、戴尔的 C 系列和 R 系列等，现在这批服务器基本上已经被淘汰到二手市场了</ul><p>由于大厂民用板太贵，而二手寨板又太不可靠（我不想把我家烧掉 QAQ）,权衡价格、设计、可扩展性以及可玩性之后，我最终选择了戴尔 C6100：<ul><li>双路 1366 槽 CPU<li>12 个 DDR3 内存插槽，每块 CPU 都有 3 个内存通道，还支持 (REG) ECC 内存<li>没有标准 PCI-e 接口，但有 PCI-e Riser 接口，插上升高卡或转向卡之后就能插全尺寸显卡了。 C6100 支持双路 1366 CPU，双通道 DDR3 1333 内存，家用/ECC 都支持，没有 PCI-e x16 接口，但有 PCI-e Riser 接口，插上升高卡或转向卡之后就能插全尺寸显卡了。<li>由于是刀片服务器，与民用 ATX 架构在很多地方不兼容，例如电源、机箱<li>便宜，最近几年有大量从企业机房中退役的 C6100 进入了二手市场，价格非常好看</ul><p>在闲鱼淘到一块，卖家送了散热器和散热风扇、用来配合 ATX 电源的升压模块，还送了两块 E5507 用来保护 CPU 插槽、亮机！总共 250 软妹币包邮。<p><img alt=主板 src=/pictures/5975d47a32139.png><h2 id=nei-cun>内存</h2><p>虽然主板能插普通家用内存，但 ECC 内存非常便宜，现在平均 10 元 1G。 上闲鱼花 170 元买到 4 条 4G 1333 DDR3 ECC 三星内存，带马甲。<p><img alt=内存 src=/pictures/5975d4d76ac4f.png><h2 id=xian-qia>显卡</h2><p>其实是不需要显卡的，主板集成了一块 64M 显存的显卡，但考虑到可能之后会装个 Windows 系统玩玩之类的，我在电脑城中随便找了一家店花了 60 元收了一块二手影驰 GT610 亮机，2G 版，散热片式被动散热，功耗 30W 左右。<h2 id=ying-pan>硬盘</h2><p>这台机器只是临时用用，所以上淘宝捡了两块 160G 二手迈拓硬盘，一块 40 元，两块 80 元，组 RAID0，将就着先用几天。<p><img alt=硬盘 src=/pictures/5975d4e502b15.png><h2 id=dian-yuan>电源</h2><p>这方面我纠结了很久：究竟是用家用电源还是上服务器电源？ 最后因为噪音和线路方面的原因选择了家用电源。整机最耗电的应该就是 CPU 了，不超频的话，两块满载时总功耗应该在 200 瓦左右，加上杂七杂八的能耗，整机满载差不多 300W，考虑到转换损耗，况且可能要升级显卡或加硬盘，留出 200W，那么最终的选择就是 500W。 最终，我捡到了一块安钛克 VP500P V2，500W。 这电源原价大概二三百元，在闲鱼遇到一个人非常好的卖家，看到我是学生,还给我免了邮费，最终 99 元到手。<h1 id=jie-ge-hui-zong>价格汇总</h1><ul><li>CPU 240 元<li>主板 250 元<li>内存 180 元<li>硬盘 80 元<li>电源 100 元<li>亮机卡 60 元</ul><p>总计 910 元<h1 id=zu-zhuang>组装</h1><p>组装过程没什么好说的，只是因为用了 ATX 电源，改线的过程比较麻烦。<p><img alt=配件 src=/pictures/5975d50859ea9.png> <img alt=机器1 src=/pictures/5975d5307c703.png> <img alt=机器2 src=/pictures/5975d54cf0079.png><h1 id=xing-neng>性能</h1><p>首先先装上 Windows 10 试试，听说 win10 对多 CPU 的支持已经很不错了，先体验一下再装成 Debian 吧。 因为不想花太多时间折腾 Windows，所以只用 CPUZ 测试了一下，毕竟这台机器最亮眼的就是 CPU 性能，其它只是用来“亮机”的。<p><img alt=CPUZ src=/pictures/5975d605e3df9.png><p>这毕竟是一台 900 元组装的机器，所以不要对其要求过高。 与最新（2017 年 7 月）的酷睿 i7-7700k 相比，单核心性能相当于它的一半（毕竟 10 年老 U），但这机器可是 12 核 24 线程！！！ i7 的 4 核 8 线程可是弱爆了，X5650*2 的 CPUZ 多核跑分是 7700k 的近 1.5 倍（144%）。可别忘了，i7-7700k 京东价现在是 2500 rmb，是咱整机的 2.5 倍！<h1 id=gong-hao>功耗</h1><p>这方面肯定是不如新架构的。但是假如你需要大量 CPU 算力，又觉得新架构的服务器、高端民用架构太贵，其实这机器的表现还不错。相较于 5960x（不与 6950x 比，一是因为差距太大，二是因为牙膏厂故意把 6950x 涨价涨上天，现在性价比没有可比性），性能强 10%~20%，而功耗大 25%，也还好吧。<h1 id=que-dian>缺点</h1><p>这部分更新于 2017 年底，现在我已经把这机器出手了，因为它的问题实在是太多了...<h2 id=zao-yin>噪音</h2><p>这块主板是作为服务器设计的，所以噪音问题不用多说大家就能感受到了... 毕竟有两块 CPU 风扇，根据我用手机软件测试的结果，它们转起来的时候有五十多分贝...主板上没有风扇的接口，两块散热风扇只能用转接线接到电源大 D 4Pin 口上供电，所以 PWM 肯定是不存在的，想要降低噪音，只能手动通过物理方式，比如降压什么的...<h2 id=rui-pin>睿频</h2><p>还是这两个风扇...散热能力比较差。正常的服务器机箱上都会有几个高转速风扇（有些甚至能到万转以上）保证空气的流通性，然而我这机器并没有机箱...虽然裸奔也能在一定程度上缓解散热压力，但由于风扇不给力，有几次高负载时甚至过热到自动关机... 因此，这机器根本“睿”不起来，不过好在核多线程多，就算不“睿”性能也不差。<h1 id=zong-jie>总结</h1><p>从 5 月底开始策划、买配件，到现在 7 月底发这篇文章，历时近两个月，经历了不少失败，走了不少弯路，让我这穷鬼学到了不少东西。总之，ALL FOR FUN！看着任务管理器中的 24 个框框，成就感爆表！<p>但是，不推荐大家都这么搞。毕竟二手市场水深，况且这样的机器不论在安全性、外观还是可维护性都不好。如果你不是手头非常紧又非常想在任务管理器里数框框，不要组装类似的机器。<del>反正我已经退坑了🥴</del></div><div id=comments-issue-id style=display:none>20</div><div id=comments-addition style=display:none>[{"user":{"login":"EAimTY","html_url":"https://www.eaimty.com/","avatar_url":"https://secure.gravatar.com/avatar/f64037e002ad7b01fe9ee60351bfd1d2?d=retro"},"created_at":"2017-07-24T12:30:07Z","body":"> 三核心，完了，我躺枪了_(:з」∠)_\n\n看来土豆也是农企的老(shou)粉(hai)丝(zhe)啊😂"},{"user":{"login":"Benny小土豆","html_url":"https://www.bennythink.com","avatar_url":"https://secure.gravatar.com/avatar/38a94d1b56f913b2531ab3a36577d3e4?d=retro"},"created_at":"2017-07-24T15:24:33Z","body":"> > 三核心，完了，我躺枪了_(:з」∠)_\n> \n> 看来土豆也是农企的老(shou)粉(hai)丝(zhe)啊😂\n\n一直想开核，从未成功过。反正也七年了，值了😂"},{"user":{"login":"Ccchen","html_url":"https://ezo.biz","avatar_url":"https://secure.gravatar.com/avatar/bbedf1bb8fd5be28e1a76fd2cdb3e673?d=retro"},"created_at":"2017-07-28T22:59:08Z","body":"穷学生居然交得起这么贵的电费。。。"},{"user":{"login":"Benny小土豆","html_url":"https://www.bennythink.com","avatar_url":"https://secure.gravatar.com/avatar/38a94d1b56f913b2531ab3a36577d3e4?d=retro"},"created_at":"2017-07-24T11:51:04Z","body":"三核心，完了，我躺枪了_(:з」∠)_"},{"user":{"login":"EAimTY","html_url":"https://www.eaimty.com/","avatar_url":"https://secure.gravatar.com/avatar/f64037e002ad7b01fe9ee60351bfd1d2?d=retro"},"created_at":"2017-07-29T05:06:31Z","body":"> 穷学生居然交得起这么贵的电费。。。\n\n我这边电费五毛一度，按整机300W算，开机满载6小时1块钱，而且开机后不一定满载啊😂没有处理任务的时候基本不开机，花不了多少电费～"},{"user":{"login":"Kios","html_url":"https://www.mkernel.com","avatar_url":"https://secure.gravatar.com/avatar/21404b26b1a08b14cbc746dee7aba00b?d=retro"},"created_at":"2017-10-26T12:51:39Z","body":"这核心数看的真爽"},{"user":{"login":"Mark","avatar_url":"https://secure.gravatar.com/avatar/15b0dbad253ee6b27e93dc9e5ada0bf3?d=retro"},"created_at":"2017-09-16T10:30:57Z","body":"> 内存现在买买贵了 几个月前还是5元/G \n> 带马甲的内存发热更大 同价位的情况尽量挑选没有马甲的低压条\n> ECC不等于RECC 你这板子不能上民用条的 有些工作站可能可以 比如D20等\n> 北桥的散热没做好 久了容易不稳定 \n> Dell和hp的其实很不值，民用简直是流氓 相比来说广达和富士康代工的一些小厂板子对个人用户更友好些 \n> Nehlaem架构对三缓读取有缺陷 价格也虚高 单核频率也不高 ，\n> x5570对普通用户更有性价比些，5650的家用性能根本不能跟4670k对比 单路超频后可能可以跟2500对比\n> \n> 现在购买1366平台的确很有性价比，不过以后就别想倒卖出去了 \n> 不知道c6100是不是纯12V供电的 如果是的话注意给mos散热 防止偏相掉电\n> 就现在这种青黄不接的时期，我更建议使用民用平台的SB架构\n\n是SB架构的民用平台 打错了"},{"user":{"login":"Mark","avatar_url":"https://secure.gravatar.com/avatar/15b0dbad253ee6b27e93dc9e5ada0bf3?d=retro"},"created_at":"2017-09-16T10:30:04Z","body":"内存现在买买贵了 几个月前还是5元/G \n带马甲的内存发热更大 同价位的情况尽量挑选没有马甲的低压条\nECC不等于RECC 你这板子不能上民用条的 有些工作站可能可以 比如D20等\n北桥的散热没做好 久了容易不稳定 \nDell和hp的其实很不值，民用简直是流氓 相比来说广达和富士康代工的一些小厂板子对个人用户更友好些 \nNehlaem架构对三缓读取有缺陷 价格也虚高 单核频率也不高 ，\nx5570对普通用户更有性价比些，5650的家用性能根本不能跟4670k对比 单路超频后可能可以跟2500对比\n\n现在购买1366平台的确很有性价比，不过以后就别想倒卖出去了 \n不知道c6100是不是纯12V供电的 如果是的话注意给mos散热 防止偏相掉电\n就现在这种青黄不接的时期，我更建议使用民用平台的SB架构"},{"user":{"login":"RVIER","avatar_url":"https://secure.gravatar.com/avatar/6034259ba3ddea6565f63320769f5132?d=retro"},"created_at":"2017-10-14T09:28:27Z","body":"> > > 三核心，完了，我躺枪了_(:з」∠)_\n> > \n> > 看来土豆也是农企的老(shou)粉(hai)丝(zhe)啊😂\n> \n> 一直想开核，从未成功过。反正也七年了，值了😂\n\n我有一块x3-440，不知道好的坏的，吃灰去了"},{"user":{"login":"TheFairyTale","html_url":"http://thefairytale.dreamdropsakura.top","avatar_url":"https://secure.gravatar.com/avatar/4ef273c942b7a781eca32073d99bf18d?d=retro"},"created_at":"2018-01-31T15:45:28Z","body":"哇好厉害的样子\n要过年了我也打算组一台二手机用，看博主文章似乎闲鱼上没什么骗子，嗯等压岁钱发了组一台玩玩w~"},{"user":{"login":"EAimTY","html_url":"https://www.eaimty.com/","avatar_url":"https://secure.gravatar.com/avatar/f64037e002ad7b01fe9ee60351bfd1d2?d=retro"},"created_at":"2018-02-01T17:18:32Z","body":"> 哇好厉害的样子\n> 要过年了我也打算组一台二手机用，看博主文章似乎闲鱼上没什么骗子，嗯等压岁钱发了组一台玩玩w~\n\n这台机器只侧重于CPU性能，如果想装一台日常使用的机器，可千万别按照这篇文章做_(:з」∠)_\n闲鱼上的骗子可不少，能买到什么只取决于你对要买的东西的了解程度和运气_(:з」∠)_"},{"user":{"login":"Benny","html_url":"https://www.bennythink.com","avatar_url":"https://secure.gravatar.com/avatar/38a94d1b56f913b2531ab3a36577d3e4?d=retro"},"created_at":"2018-01-23T04:18:46Z","body":"> > > > 三核心，完了，我躺枪了_(:з」∠)_\n> > > \n> > > 看来土豆也是农企的老(shou)粉(hai)丝(zhe)啊😂\n> > \n> > 一直想开核，从未成功过。反正也七年了，值了😂\n> \n> 我有一块x3-440，不知道好的坏的，吃灰去了\n\n对对对 我家里的PC就是这个处理器"},{"user":{"login":"EAimTY","html_url":"https://www.eaimty.com/","avatar_url":"https://secure.gravatar.com/avatar/f64037e002ad7b01fe9ee60351bfd1d2?d=retro"},"created_at":"2017-08-12T14:30:59Z","body":"> 组装大法好，我是直接买的主机QAQ现在工作就是买了台小船凑合用用\n\n组装好还是直接买整机好貌似需要看脸吧 `_(:з」∠)_`"},{"user":{"login":"RVIER","avatar_url":"https://secure.gravatar.com/avatar/6034259ba3ddea6565f63320769f5132?d=retro"},"created_at":"2017-10-14T09:29:22Z","body":"E5神教路过"},{"user":{"login":"无人小站","html_url":"https://www.ercc.cc","avatar_url":"https://secure.gravatar.com/avatar/659fbdc672264b99a25778d21750e6ad?d=retro"},"created_at":"2017-08-12T10:11:23Z","body":"组装大法好，我是直接买的主机QAQ现在工作就是买了台小船凑合用用"}]</div><style>#comment-header,#comment-list>li{margin:1em auto}#comment-avatar,#comment-tip{margin:auto .2em}#comment-action-avatar,#comment-avatar{width:1em;height:1em}#comment-action-info>*,#comment-action-input>*,#comment-info>*{display:inline-block;vertical-align:middle}#comment-header{font-size:1.6em;font-weight:700;line-height:1.6em}#comment-tip{font-style:italic}#comment-list{list-style:none;padding:0}#comment-action-author,#comment-author{font-weight:700;margin:auto .4em}#comment-datetime{font-size:.8em;font-style:italic}#comment-body{margin:auto 1.8em}#comment-action-info>*{margin:1em .2em}#comment-action-input{height:2em;width:100%;margin:1em auto}#comment-action-input>*{height:100%;margin:0 .2em}#comment-action-textarea{width:calc(100% - 8em)}#comment-action-post{width:6em}#comment-action-login{margin:1em .3em}</style><ol id=comment-list></ol><div id=comment-action></div><script>const y=e=>{var t=/\\([\\\|`*_{}\[\]()#+\-~])/g,n=/\n *&gt; *([^]*?)(?=(\n|$){2})/g,i=/\n( *)(?:[*\-+]|((\d+)|([a-z])|[A-Z])[.)]) +([^]*?)(?=(\n|$){2})/g,o=/(^|[^A-Za-z\d\\])(([*_])|(~)|(\^)|(--)|(\+\+)|`)(\2?)([^<]*?)\2\8(?!\2)(?=\W|_|$)/g,a=/^.*\n( *\|( *:?-+:?-+:? *\|)* *\n|)/,c=/.*\n/g,m=/\||(.*?[^\\])\|/g;const l=(t,n)=>{e=e.replace(t,n)},d=(e,t)=>"<"+e+">"+t+"</"+e+">",r=e=>e.replace(n,((e,t)=>d("blockquote",r(u(t.replace(/^ *&gt; */gm,"")))))),s=e=>e.replace(i,((e,t,n,i,o,a)=>(e=d("li",u(a.split(RegExp("\n ?"+t+"(?:(?:\\d+|[a-zA-Z])[.)]|[*\\-+]) +","g")).map(s).join("</li><li>"))),"\n"+(n?'<ol start="'+(i?n+'">':parseInt(n,36)-9+'" style="list-style-type:'+(o?"low":"upp")+'er-alpha">')+e+"</ol>":d("ul",e))))),u=e=>e.replace(o,((e,t,n,i,o,a,c,m,l,r)=>t+d(i?l?"strong":"em":o?l?"s":"sub":a?"sup":c?"small":m?"big":"code",u(r))));var p=[],h=0;return e="\n"+e+"\n",l(/</g,"&lt;"),l(/>/g,"&gt;"),l(/\t|\r|\uf8ff/g,"  "),e=r(e),l(/^([*\-=_] *){3,}$/gm,"<hr/>"),e=s(e),l(/<\/(ol|ul)>\n\n<\1>/g,""),l(/\n((```|~~~).*\n?([^]*?)\n?\2|((    .*?\n)+))/g,((e,t,n,i,o)=>(p[--h]=d("pre",d("code",i||o.replace(/^    /gm,""))),h+""))),l(/((!?)\[(.*?)\]\((.*?)( ".*")?\)|\\([\\`*_{}\[\]()#+\-.!~]))/g,((e,n,i,o,a,c,m)=>(p[--h]=a?i?'<img src="'+a+'" alt="'+o+'"/>':'<a href="'+a+'">'+u(o).replace(t,"$1")+"</a>":m,h+""))),l(/&lt;(.*?)&gt;/g,((e,n)=>'<a href="'+n+'">'+u(n).replace(t,"$1")+"</a>")),l(/\n(( *\|.*?\| *\n)+)/g,((e,n)=>{var i=n.match(a)[1];return"\n"+d("table",n.replace(c,((e,n)=>e==i?"":d("tr",e.replace(m,((e,o,a)=>a?d(i&&!n?"th":"td",u(o||"").replace(t,"$1")):""))))))})),l(/(?=^|>|\n)([>\s]*?)(#{1,6}) (.*?)( #*)? *(?=\n|$)/g,((e,n,i,o)=>n+d("h"+i.length,u(o).replace(t,"$1")))),l(/(?=^|>|\n)\s*\n+([^<]+?)\n+\s*(?=\n|<|$)/g,((e,n)=>d("p",u(n).replace(t,"$1")))),l(/-\d+\uf8ff/g,(e=>p[parseInt(e,10)])),e.trim()},f=e=>{let t=t=>e.next(t),n=t=>e.throw(t);return new Promise(((i,o)=>{let a=e=>{e.done?i(e.value):Promise.resolve(e.value).then(t,n).then(a,o)};a(e.next())}))};let g;const m=document.getElementById("comments-issue-id").innerText,n=new URL(window.location.href);let q,p=n.searchParams.get("github_access_token");p&&(document.cookie=`github_access_token=${p};Path=/;Secure;SameSite=Strict`,n.searchParams.delete("github_access_token"),window.location.replace(n)),null!=p||(p=null==(q=document.cookie.split(";").find((e=>e.trim().startsWith("github_access_token="))))?void 0:q.trim().substring(20));const r=()=>{document.cookie="github_access_token=;expires=Thu, 01 Jan 1970 00:00:00 GMT;Path=/;Secure;SameSite=Strict",p=null},t=()=>f(function*(){var e;let n;if(g=JSON.parse(null!=(n=null==(e=document.getElementById("comments-addition"))?void 0:e.innerText)?n:"[]"),p){if(200!==(e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"GET"})).status)return r(),yield t()}else e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}`,{method:"GET"});200===e.status&&(g=g.concat(yield e.json()))}()),u=()=>{g.sort(((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()));let e=document.getElementById("comment-list");e.innerHTML="";var t=document.createElement("div");for(t.id="comment-header",t.innerText="Comments",e.appendChild(t),0===g.length&&((t=document.createElement("div")).id="comment-tip",t.innerText="No comment yet",e.appendChild(t)),t=0;t<g.length;t++){let o=document.createElement("li");var n=document.createElement("div");n.id="comment-info";var i=document.createElement("img");i.id="comment-avatar",i.src=g[t].user.avatar_url,n.appendChild(i),(i=document.createElement("a")).id="comment-author",i.innerText=g[t].user.login,g[t].user.html_url&&(i.href=g[t].user.html_url),n.appendChild(i),(i=document.createElement("div")).id="comment-datetime",i.innerText=new Date(g[t].created_at).toLocaleString(),n.appendChild(i),o.appendChild(n),(n=document.createElement("div")).id="comment-body",n.innerHTML=y(g[t].body),o.appendChild(n),e.appendChild(o)}},v=()=>f(function*(){let e=document.getElementById("comment-action");e.innerHTML="";var n=document.createElement("div");if(n.id="comment-header",n.innerText="Leave a comment",e.appendChild(n),p){if(200===(n=yield fetch(`https://comments.eaimty.com/userinfo?github_access_token=${p}`,{method:"GET"})).status){n=yield n.json();let o=document.createElement("div");o.id="comment-action-info";var i=document.createElement("img");i.id="comment-action-avatar",i.src=n.avatar_url,o.appendChild(i),(i=document.createElement("a")).id="comment-action-author",i.innerText=n.login,i.href=n.html_url,o.appendChild(i);let a=document.createElement("button");a.id="comment-action-logout",a.innerText="Logout",a.addEventListener("click",(()=>{r(),v()})),o.appendChild(a),e.appendChild(o),(n=document.createElement("div")).id="comment-tip",n.innerText="Before commenting, please think about whether your comment is meaningful? Is it related to the topic? Is it rational and friendly? If you were someone else, would you feel uncomfortable seeing this comment?",e.appendChild(n),(n=document.createElement("div")).id="comment-action-input";let c=document.createElement("textarea");c.id="comment-action-textarea",c.placeholder="Leave a comment",n.appendChild(c);let l=document.createElement("button");return l.id="comment-action-post",l.innerText="Comment",l.addEventListener("click",(()=>f(function*(){a.disabled=!0,c.disabled=!0,l.disabled=!0;let e=c.value.trim();0!==e.length&&(201===(yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"POST",body:JSON.stringify({body:e})})).status?t().then((()=>u())).then((()=>v())):(r(),yield v(),window.alert("Failed to post comment")))}()))),n.appendChild(l),void e.appendChild(n)}r()}(n=document.createElement("div")).id="comment-tip",n.innerText="Clicking the login button means you agree to use cookies to store your GitHub Access Token",e.appendChild(n),(n=document.createElement("button")).id="comment-action-login",n.innerText="Login with GitHub",n.addEventListener("click",(()=>window.location.replace(`https://comments.eaimty.com/login?redirect_uri=${window.location.href}`))),e.appendChild(n)}());t().then((()=>u())).then((()=>v()))</script></div>