<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=#000000 id=color_chrome name=theme-color><meta content=#000000 id=color_safari name=apple-mobile-web-app-status-bar-style><meta content="EAimTY's Blog" name=description><link rel="Shortcut Icon" href=https://www.eaimty.com/favicon.ico><link href=https://www.eaimty.com/favicon.ico rel=Bootmark><link title="EAimTY's Blog" href=https://www.eaimty.com/rss.xml rel=alternate type=application/rss+xml><style>#title,body{line-height:1.6em}body{background:#000;color:#00c000;font-size:1.2em}#container{margin:2.4em auto;width:72%}#header{text-align:center}#header>a{font-size:.96em;margin:auto 1em}#title{font-size:1.6em;font-weight:700;margin:1em auto}#date{font-style:italic}#list>li{margin:.8em auto;list-style:disc}img{max-width:100%}a{color:inherit;text-decoration:none}#content a,a:hover{text-decoration:underline}pre{padding:1em;overflow:auto;background:#1b1d16}:not(pre) >code{padding:.2em;background:#1b1d16;overflow:auto}blockquote{padding:0 1em;margin:0;border-left:.25em solid #212121}@media (max-width:600px){#container{width:88%}#header>a{margin:auto .3em}}</style><title>CentOS 7 下使用 yum 安装 Nginx+MySQL+PHP7.x 环境 - EAimTY's Blog</title><body><div id=header><a href=https://www.eaimty.com>EAimTY's Blog</a><a href=https://www.eaimty.com/about/>About</a><a href=https://www.eaimty.com/friends/>Friends</a></div><div id=container><a href=https://www.eaimty.com/2016/centos-install-nginx-mysql-php-using-yum/ id=title>CentOS 7 下使用 yum 安装 Nginx+MySQL+PHP7.x 环境</a><div id=date>2016-03-05</div><div id=content><p><strong>2018 年 2 月 2 日更新：将系统换为 CentOS 7</strong><p>这篇文章的初始版本所适用的系统是 CentOS 6，两年后，原文章中的许多方法已不再适用。 为了保证稳定性与安全性，我们使用的所有软件都应确保是最新的稳定版本。<h1 id=pei-zhi-yumyuan>配置yum源</h1><p>在这一步之前最好确定原本的 yum 源是官方源。<h2 id=epel>EPEL</h2><p>首先我们需要安装 EPEL 的 yum 源。Enterprise Linux 额外软件包（Extra Packages for Enterprise Linux，EPEL）是由来自 Fedora Project 的志愿者发起的社区力量，为了创建由高质量的附加软件组成的、用于补足 RHEL 和其他兼容版本的软件仓库。可以直接用 yum 安装：<p><code># yum install epel-release</code><h2 id=remi>remi</h2><p>安装 EPEL 源的目的，其实是为了安装另一个 yum 源：remi。remi 源依赖 EPEL 源。<p><code># rpm -ivh https://rpms.remirepo.net/enterprise/remi-release-7.rpm</code><p><code># rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-remi</code><p>到这里 remi 源就安装好了，但我们需要手动启用 remi 的 PHP 专用源：<p><code># ls /etc/yum.repos.d/</code><p>可以看到有 <code>remi-php70.repo</code>、<code>remi-php71.repo</code>、<code>remi-php72.repo</code> 等文件。 如果将 <code>remi-php70.repo</code> 中 <code>[remi-php70]</code> 段的 <code>enabled=0</code> 改为 <code>enabled=1</code>，之后安装的就是 PHP7.0 如果将 <code>remi-php71.repo</code> 中 <code>[remi-php71]</code> 段的 <code>enabled=0</code> 改为 <code>enabled=1</code>，之后安装的就是 PHP7.1 如果将 <code>remi-php72.repo</code> 中 <code>[remi-php72]</code> 段的 <code>enabled=0</code> 改为 <code>enabled=1</code>，之后安装的就是 PHP7.2 以此类推<p>这时运行：<p><code># yum list php</code><p>假如看到版本号是你所希望安装的版本，就说明换 remi 源成功了。<h2 id=mysql>MySQL</h2><p>注意，MySQL 版本号并不是越大越好 目前 MySQL 的大版本号有 5.5、5.6、5.7、8.0（开发中，不建议用于生产环境中） 一般来说，这四个大版本的版本号越大，相应的就需要越强的性能来驱动<p>MySQL 官方的换源教程非常详细，可以直接参考： <a href=https://dev.mysql.com/downloads/repo/yum>https://dev.mysql.com/downloads/repo/yum</a><h2 id=nginx>Nginx</h2><p>最后要解决的是 Nginx 换源，推荐使用 Nginx 官方的源：<p><code># rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</code><p>至此，换源工作就彻底完成了。<h1 id=an-zhuang-ruan-jian-bao>安装软件包</h1><p>这一步简单，用 yum 一股脑装上即可:<p><code># yum install nginx mysql-community-server php-fpm</code><p>还需要安装一些 PHP 的组件，按需求安装，这里只安装常用的一些：<p><code># yum install php-pdo php-mysql php-gd php-intl php-mbstring php-bcmath</code><h1 id=pei-zhi-ruan-jian>配置软件</h1><h2 id=kai-qi-zi-qi>开启自启</h2><p>先来把这堆东西的自启动打开：<p><code># systemctl enable nginx</code><p><code># systemctl enable mysqld</code><p><code># systemctl enable php-fpm</code><p>如果机器上同时装了 Apache，记得要禁止它自启，防止它与 Nginx 抢端口：<p><code># systemctl disable apache</code><h2 id=pei-zhi-nginx>配置 Nginx</h2><p>可以删掉 Nginx 默认的配置文件与目录：<p><code># rm -rf /etc/nginx/conf.d/default.conf /usr/share/nginx</code><p>新建一个配置文件：<p><code># vi /etc/nginx/conf.d/www.conf</code><p>输入以下内容：<pre class=language-conf data-lang=conf><code class=language-conf data-lang=conf>server {
    listen       80;
    server_name  localhost; //这里改成你的域名
    root         /home/www; //这里改成准备放网页文件的目录
    index        index.php index.html index.htm;

    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_pass 127.0.0.1:9000;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
</code></pre><p>然后修改一下 Nginx 允许上传最大文件的大小，并禁止 Nginx 在 HTTP Header 中发送服务器信息：<p><code># vi /etc/nginx/nginx.conf</code> 在 <code>include /etc/nginx/conf.d/*.conf;</code> 这一行上面插入两行：<pre class=language-conf data-lang=conf><code class=language-conf data-lang=conf>client_max_body_size 200m;
server_tokens off;
</code></pre><p>这样 Nginx 就配置完了，下面配置 MySQL<h2 id=pei-zhi-mysql>配置 MySQL</h2><p>启动 MySQL：<p><code># systemctl start mysql</code><p><code># mysql_secure_installation</code><p>这时会进入 MySQL 的安装向导中，按照步骤完成即可。<h2 id=pei-zhi-php>配置 PHP</h2><p>只剩下 PHP 的配置了。 修改一下 PHP 的配置文件就可以了：<p><code># vi /etc/php.ini</code><p>首先修改 PHP 允许上传最大文件的大小和数量： 搜索 <code>upload_max_filesize=2M</code> ，改为 <code>upload_max_filesize=200M</code>，这里的 200M 就是最大可上传的文件大小； 搜索 <code>max_file_uploads=2</code>，改为 <code>max_file_uploads=200</code>，这里的 200 就是一次性最多可上传的文件数。<p>使 HTTP Header 中不显示 PHP 信息，搜索 <code>expose_php = On</code>，改为 <code>expose_php = Off</code>。<p>修改时区：<p>在 vi/vim 命令模式中键入 <code>/date.timezone</code> 来查找 <code>date.timezone</code> 字符串 找到 <code>;date.timezone =</code> 这一行，取消掉注释（就是删掉行首的分号），然后将其值设置为 <code>"Asia/Shanghai"</code>。<p>关于PHP所支持的时区列表，参见 <a href=https://www.php.net/manual/zh/timezones.php>https://www.php.net/manual/zh/timezones.php</a><p>最后这一行长这样：<pre class=language-conf data-lang=conf><code class=language-conf data-lang=conf>date.timezone = "Asia/Shanghai"
</code></pre><p>另外，如果使用的是 Typecho 程序，需要打开 PHP 的 pathinfo： 搜索 <code>cgi.fix_pathinfo = </code>，取消掉行首的注释，把参数改为 1，也就是：<pre class=language-conf data-lang=conf><code class=language-conf data-lang=conf>cgi.fix_pathinfo = 1
</code></pre><h1 id=ce-shi-lnmp>测试LNMP</h1><p>首先启动这些软件：<p><code># systemctl start nginx</code><p><code># systemctl start mysqld</code><p><code># systemctl start php-fpm</code><p>建立 web 目录：<p><code># mkdir /home/www</code>（就是在配置 Nginx 那一步所设置的存放网站文件的目录）<p>放一个 phpinfo：<p><code># vi /home/www/index.php</code><p>输入：<pre class=language-php data-lang=php><code class=language-php data-lang=php>&LT?php phpinfo(); ?>
</code></pre><p>这时访问你的域名或 IP，不出意外就可以看到 phpinfo 了。<p>至此，LNMP 环境就安装完成了，把你的网页放在设置好的目录下，全世界就可以访问你的站点了。</div><div id=comments-issue-id style=display:none>9</div><div id=comments-addition style=display:none>[{"user":{"login":"yangyi","avatar_url":"https://secure.gravatar.com/avatar/6d43f594683911aeebc201245202c315?d=retro"},"created_at":"2016-06-07T09:42:54Z","body":"写的太好了，大赞！"}]</div><style>#comment-header,#comment-list>li{margin:1em auto}#comment-avatar,#comment-tip{margin:auto .2em}#comment-action-avatar,#comment-avatar{width:1em;height:1em}#comment-action-info>*,#comment-action-input>*,#comment-info>*{display:inline-block;vertical-align:middle}#comment-header{font-size:1.6em;font-weight:700;line-height:1.6em}#comment-tip{font-style:italic}#comment-list{list-style:none;padding:0}#comment-action-author,#comment-author{font-weight:700;margin:auto .4em}#comment-datetime{font-size:.8em;font-style:italic}#comment-body{margin:auto 1.8em}#comment-action-info>*{margin:1em .2em}#comment-action-input{height:2em;width:100%;margin:1em auto}#comment-action-input>*{height:100%;margin:0 .2em}#comment-action-textarea{width:calc(100% - 8em)}#comment-action-post{width:6em}#comment-action-login{margin:1em .3em}</style><ol id=comment-list></ol><div id=comment-action></div><script>const y=e=>{var t=/\\([\\\|`*_{}\[\]()#+\-~])/g,n=/\n *&gt; *([^]*?)(?=(\n|$){2})/g,i=/\n( *)(?:[*\-+]|((\d+)|([a-z])|[A-Z])[.)]) +([^]*?)(?=(\n|$){2})/g,o=/(^|[^A-Za-z\d\\])(([*_])|(~)|(\^)|(--)|(\+\+)|`)(\2?)([^<]*?)\2\8(?!\2)(?=\W|_|$)/g,a=/^.*\n( *\|( *:?-+:?-+:? *\|)* *\n|)/,c=/.*\n/g,m=/\||(.*?[^\\])\|/g;const l=(t,n)=>{e=e.replace(t,n)},d=(e,t)=>"<"+e+">"+t+"</"+e+">",r=e=>e.replace(n,((e,t)=>d("blockquote",r(u(t.replace(/^ *&gt; */gm,"")))))),s=e=>e.replace(i,((e,t,n,i,o,a)=>(e=d("li",u(a.split(RegExp("\n ?"+t+"(?:(?:\\d+|[a-zA-Z])[.)]|[*\\-+]) +","g")).map(s).join("</li><li>"))),"\n"+(n?'<ol start="'+(i?n+'">':parseInt(n,36)-9+'" style="list-style-type:'+(o?"low":"upp")+'er-alpha">')+e+"</ol>":d("ul",e))))),u=e=>e.replace(o,((e,t,n,i,o,a,c,m,l,r)=>t+d(i?l?"strong":"em":o?l?"s":"sub":a?"sup":c?"small":m?"big":"code",u(r))));var p=[],h=0;return e="\n"+e+"\n",l(/</g,"&lt;"),l(/>/g,"&gt;"),l(/\t|\r|\uf8ff/g,"  "),e=r(e),l(/^([*\-=_] *){3,}$/gm,"<hr/>"),e=s(e),l(/<\/(ol|ul)>\n\n<\1>/g,""),l(/\n((```|~~~).*\n?([^]*?)\n?\2|((    .*?\n)+))/g,((e,t,n,i,o)=>(p[--h]=d("pre",d("code",i||o.replace(/^    /gm,""))),h+""))),l(/((!?)\[(.*?)\]\((.*?)( ".*")?\)|\\([\\`*_{}\[\]()#+\-.!~]))/g,((e,n,i,o,a,c,m)=>(p[--h]=a?i?'<img src="'+a+'" alt="'+o+'"/>':'<a href="'+a+'">'+u(o).replace(t,"$1")+"</a>":m,h+""))),l(/&lt;(.*?)&gt;/g,((e,n)=>'<a href="'+n+'">'+u(n).replace(t,"$1")+"</a>")),l(/\n(( *\|.*?\| *\n)+)/g,((e,n)=>{var i=n.match(a)[1];return"\n"+d("table",n.replace(c,((e,n)=>e==i?"":d("tr",e.replace(m,((e,o,a)=>a?d(i&&!n?"th":"td",u(o||"").replace(t,"$1")):""))))))})),l(/(?=^|>|\n)([>\s]*?)(#{1,6}) (.*?)( #*)? *(?=\n|$)/g,((e,n,i,o)=>n+d("h"+i.length,u(o).replace(t,"$1")))),l(/(?=^|>|\n)\s*\n+([^<]+?)\n+\s*(?=\n|<|$)/g,((e,n)=>d("p",u(n).replace(t,"$1")))),l(/-\d+\uf8ff/g,(e=>p[parseInt(e,10)])),e.trim()},f=e=>{let t=t=>e.next(t),n=t=>e.throw(t);return new Promise(((i,o)=>{let a=e=>{e.done?i(e.value):Promise.resolve(e.value).then(t,n).then(a,o)};a(e.next())}))};let g;const m=document.getElementById("comments-issue-id").innerText,n=new URL(window.location.href);let q,p=n.searchParams.get("github_access_token");p&&(document.cookie=`github_access_token=${p};Path=/;Secure;SameSite=Strict`,n.searchParams.delete("github_access_token"),window.location.replace(n)),null!=p||(p=null==(q=document.cookie.split(";").find((e=>e.trim().startsWith("github_access_token="))))?void 0:q.trim().substring(20));const r=()=>{document.cookie="github_access_token=;expires=Thu, 01 Jan 1970 00:00:00 GMT;Path=/;Secure;SameSite=Strict",p=null},t=()=>f(function*(){var e;let n;if(g=JSON.parse(null!=(n=null==(e=document.getElementById("comments-addition"))?void 0:e.innerText)?n:"[]"),p){if(200!==(e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"GET"})).status)return r(),yield t()}else e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}`,{method:"GET"});200===e.status&&(g=g.concat(yield e.json()))}()),u=()=>{g.sort(((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()));let e=document.getElementById("comment-list");e.innerHTML="";var t=document.createElement("div");for(t.id="comment-header",t.innerText="Comments",e.appendChild(t),0===g.length&&((t=document.createElement("div")).id="comment-tip",t.innerText="No comment yet",e.appendChild(t)),t=0;t<g.length;t++){let o=document.createElement("li");var n=document.createElement("div");n.id="comment-info";var i=document.createElement("img");i.id="comment-avatar",i.src=g[t].user.avatar_url,n.appendChild(i),(i=document.createElement("a")).id="comment-author",i.innerText=g[t].user.login,g[t].user.html_url&&(i.href=g[t].user.html_url),n.appendChild(i),(i=document.createElement("div")).id="comment-datetime",i.innerText=new Date(g[t].created_at).toLocaleString(),n.appendChild(i),o.appendChild(n),(n=document.createElement("div")).id="comment-body",n.innerHTML=y(g[t].body),o.appendChild(n),e.appendChild(o)}},v=()=>f(function*(){let e=document.getElementById("comment-action");e.innerHTML="";var n=document.createElement("div");if(n.id="comment-header",n.innerText="Leave a comment",e.appendChild(n),p){if(200===(n=yield fetch(`https://comments.eaimty.com/userinfo?github_access_token=${p}`,{method:"GET"})).status){n=yield n.json();let o=document.createElement("div");o.id="comment-action-info";var i=document.createElement("img");i.id="comment-action-avatar",i.src=n.avatar_url,o.appendChild(i),(i=document.createElement("a")).id="comment-action-author",i.innerText=n.login,i.href=n.html_url,o.appendChild(i);let a=document.createElement("button");a.id="comment-action-logout",a.innerText="Logout",a.addEventListener("click",(()=>{r(),v()})),o.appendChild(a),e.appendChild(o),(n=document.createElement("div")).id="comment-tip",n.innerText="Before commenting, please think about whether your comment is meaningful? Is it related to the topic? Is it rational and friendly? If you were someone else, would you feel uncomfortable seeing this comment?",e.appendChild(n),(n=document.createElement("div")).id="comment-action-input";let c=document.createElement("textarea");c.id="comment-action-textarea",c.placeholder="Leave a comment",n.appendChild(c);let l=document.createElement("button");return l.id="comment-action-post",l.innerText="Comment",l.addEventListener("click",(()=>f(function*(){a.disabled=!0,c.disabled=!0,l.disabled=!0;let e=c.value.trim();0!==e.length&&(201===(yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"POST",body:JSON.stringify({body:e})})).status?t().then((()=>u())).then((()=>v())):(r(),yield v(),window.alert("Failed to post comment")))}()))),n.appendChild(l),void e.appendChild(n)}r()}(n=document.createElement("div")).id="comment-tip",n.innerText="Clicking the login button means you agree to use cookies to store your GitHub Access Token",e.appendChild(n),(n=document.createElement("button")).id="comment-action-login",n.innerText="Login with GitHub",n.addEventListener("click",(()=>window.location.replace(`https://comments.eaimty.com/login?redirect_uri=${window.location.href}`))),e.appendChild(n)}());t().then((()=>u())).then((()=>v()))</script></div>