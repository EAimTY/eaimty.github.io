<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=#000000 id=color_chrome name=theme-color><meta content=#000000 id=color_safari name=apple-mobile-web-app-status-bar-style><meta content="EAimTY's Blog" name=description><link rel="Shortcut Icon" href=https://www.eaimty.com/favicon.ico><link href=https://www.eaimty.com/favicon.ico rel=Bootmark><link title="EAimTY's Blog" href=https://www.eaimty.com/rss.xml rel=alternate type=application/rss+xml><style>#title,body{line-height:1.6em}body{background:#000;color:#00c000;font-size:1.2em}#container{margin:2.4em auto;width:72%}#header{text-align:center}#header>a{font-size:.96em;margin:auto 1em}#title{font-size:1.6em;font-weight:700;margin:1em auto}#date{font-style:italic}#list>li{margin:.8em auto;list-style:disc}img{max-width:100%}a{color:inherit;text-decoration:none}#content a,a:hover{text-decoration:underline}pre{padding:1em;overflow:auto;background:#1b1d16}:not(pre) >code{padding:.2em;background:#1b1d16;overflow:auto}blockquote{padding:0 1em;margin:0;border-left:.25em solid #212121}@media (max-width:600px){#container{width:88%}#header>a{margin:auto .3em}}</style><title>在 Debian 下安装 wineQQ - EAimTY's Blog</title><body><div id=header><a href=https://www.eaimty.com>EAimTY's Blog</a><a href=https://www.eaimty.com/about/>About</a><a href=https://www.eaimty.com/friends/>Friends</a></div><div id=container><a href=https://www.eaimty.com/2016/debian-install-wine-qq/ id=title>在 Debian 下安装 wineQQ</a><div id=date>2016-01-19</div><div id=content><p>最近几年，微软把 Windows 做得越来越渣。相比之下，桌面 Linux 的势头越来越猛，很多用户看中了 Linux 的安全性、开源性与稳定性，便也踏上了这条大船。<p>可很多新的 Linuxer 在第一次进入桌面时便傻了眼：Linux 下怎么用软件啊？很多“必备软件”为什么在 Linux 下没有啊... 当然，在一段时间的使用之后，用户们就都会自己用 apt、yum 之类的管理工具安装软件包了。但是，还是有一些软件仅能在 Windows 下运行。假如用户既不想装双系统，又不想开虚拟机，那怎么办呢？两全其美的办法就是——使用 wine。<p><strong>2016 年 6 月 15 日注：已更新为 wine1.9 的使用步骤</strong><p>来看看<a href=https://zh.wikipedia.org/wiki/Wine>中文维基百科</a>上关于 Wine 的介绍：<blockquote><p>Wine是一个在x86、x86-64上允许类Unix操作系统在X Window System下运行Microsoft Windows程序的软件。另一方面，计算机程序设计师能经由Wine的程序库将视窗的程序转移至类Unix操作系统中运行。 Wine不是Windows模拟器，而是运用API转换技术实做出Linux对应到Windows相对应的函数来调用DLL以运行Windows程序。Wine是自由软件，在GNU宽通用公共许可证（LGPL）下发布。</blockquote><p>Wine 不是虚拟机，而类似于 Windows Subsystem Linux 的实现方法，它是一个用来将 Windows 专用的函数转换为 Linux、macOS、Unix、BSD 等系统相对应的函数的程序。<p>下面以 Debian（Gnome 环境）下 wineQQ 的安装为例介绍一下 wine 的使用方法<h1 id=an-zhuang-wine>安装 wine</h1><p>最新的 wine 已经升级到了 1.9，兼容性有了很大的提升，但 Debian 的仓库中默认是 wine1.6。在 <a href=https://www.winehq.org/>WineHQ 官网</a>发现有 Debian 的软件源，所以我们要先添加官方的源。<p>由于 wine 只提供 32 位版本，64 位系统需要打开 32 位软件的支持：<p><code>$ sudo dpkg --add-architecture i386</code><p>编辑 <code>/etc/apt/sources.list</code> 添加源信息：<p><code>$ sudo vim /etc/apt/sources.list</code><p>在弹出文件的末尾加上：<p><code>deb https://dl.winehq.org/wine-builds/debian/ stable main</code><p>这里需要注意，apt 需要 <code>apt-transport-https</code> 这个包才可以正常获取到 HTTPS 协议的库。<p>然后导入公钥：<p><code>$ wget https://dl.winehq.org/wine-builds/Release.key</code><p><code>$ sudo apt-key add Release.key</code><p>更新 apt 软件包列表：<p><code>$ sudo apt-get update</code><p>开始安装！<p><code>$ sudo apt-get install winehq-devel</code><p>（经过漫长的等待，终于把所有软件包都装完了。如果下载速度比较慢，推荐使用 <a href=https://github.com/ilikenwf/apt-fast>apt-fast</a> 安装。）<h1 id=an-zhuang-wine-zi-ding-yi-gong-ju-winetricks>安装 wine 自定义工具 winetricks</h1><p>winetricks 是一个用户友好的用来配置 wine 容器的工具。<p><a href=https://repo.debiancn.org/>Debian 中文软件仓库</a> 中有 winetricks 这个包，添加过这个源的同学可以直接用 apt 安装。<p>如果你不想添加这个源，也可以直接去搞到可执行文件，首先下载：<p><code>$ wget https://raw.githubusercontent.com/Winetricks/winetricks/master/src/winetricks</code><p>给它执行权限：<p><code>$ chmod +x winetricks</code><p>把它移动到 <code>/usr/local/bin</code> 下：<p><code>$ sudo mv winetricks /usr/local/bin</code><h1 id=pei-zhi-wine-huan-jing>配置 wine 环境</h1><p>首先，假如你的 Linux 是 64 位的，就需要先将 wine 设置为使用 32 位环境：<p><code>$ export WINEARCH=win32</code><p>为了让 QQ 能跑起来，需要安装一些 wine 组件：<p><code>$ winetricks -q riched20 ie6 mfc42</code><p>另外，为了使 QQ 在打开链接时 winebrowser 不报错，需要设置使用 wine 内建的 <code>urlmon.dll</code><p><code>$ winecfg</code><p>在<code>函数库</code>选项卡中的<code>已有的函数库顶替</code>中找到 <code>urlmon.dll</code>（若没有则先通过“新增函数库顶替”添加），点击<code>编辑</code>，选择载入顺序为<code>内建</code>。<p><img alt="使用内建的 urlmon.dll" src=/pictures/574649ac2861e.png><p>解决蜜汁中文字体：<p><code>$ winetricks fakechinese</code><h1 id=an-zhuang-bing-pei-zhi-qq>安装并配置QQ</h1><p>终于到了重头戏了，首先下载 QQ 的安装包，这里推荐 <a href=http://im.qq.com/lightqq/>QQ 轻聊版</a>。<p>下载后使用 Wine 打开，照常安装，我这里安装的很快，只是在注册组件那一步等了半天。 安装后，我满怀喜悦地准备打开 QQ，但直接弹出<code>安全组件错误</code>... 由于疼逊的安全组件无法在 wine 下正常运行，导致 QQ 无法启动。这让我头疼了很长一阵子...在翻阅了无数网页后，我终于找到了解决方法：<p><a href=http://www.zdfans.com/589.html>腾讯QQ7.x 去整体安全校验补丁</a><p>按照说明将 QQ 的流氓组件砍掉后，QQ 正常启动了，还剩下一个问题没有解决，那就是程序的启动快捷方式。 安装下面的内容写一个 QQ.desktop，放在 <code>~/.local/share/applications/</code> 下<pre class=language-conf data-lang=conf><code class=language-conf data-lang=conf>[Desktop Entry]
Categories=Network
Exec=wine "～/.wine/drive_c/Program Files/Tencent/QQLite/Bin/QQ.exe" '这里是QQ.exe的路径
Icon=～/.wine/drive_c/Program Files/Tencent/QQLite/Bin/qq.png '这里是图标的路径
Name=QQ
NoDisplay=false
StartupNotify=true
Terminal=false
Type=Application
Name[zh_CN]=QQ
</code></pre><p>到这里，Wine QQ 就安装完成了。</div><div id=comments-issue-id style=display:none>5</div><div id=comments-addition style=display:none>[{"user":{"login":"bigmercu","avatar_url":"https://secure.gravatar.com/avatar/87e44ae39d5fcaed9c5af1a33d52c16b?d=retro"},"created_at":"2016-05-14T07:19:42Z","body":"不错哦 试试"}]</div><style>#comment-header,#comment-list>li{margin:1em auto}#comment-avatar,#comment-tip{margin:auto .2em}#comment-action-avatar,#comment-avatar{width:1em;height:1em}#comment-action-info>*,#comment-action-input>*,#comment-info>*{display:inline-block;vertical-align:middle}#comment-header{font-size:1.6em;font-weight:700;line-height:1.6em}#comment-tip{font-style:italic}#comment-list{list-style:none;padding:0}#comment-action-author,#comment-author{font-weight:700;margin:auto .4em}#comment-datetime{font-size:.8em;font-style:italic}#comment-body{margin:auto 1.8em}#comment-action-info>*{margin:1em .2em}#comment-action-input{height:2em;width:100%;margin:1em auto}#comment-action-input>*{height:100%;margin:0 .2em}#comment-action-textarea{width:calc(100% - 8em)}#comment-action-post{width:6em}#comment-action-login{margin:1em .3em}</style><ol id=comment-list></ol><div id=comment-action></div><script>const y=e=>{var t=/\\([\\\|`*_{}\[\]()#+\-~])/g,n=/\n *&gt; *([^]*?)(?=(\n|$){2})/g,i=/\n( *)(?:[*\-+]|((\d+)|([a-z])|[A-Z])[.)]) +([^]*?)(?=(\n|$){2})/g,o=/(^|[^A-Za-z\d\\])(([*_])|(~)|(\^)|(--)|(\+\+)|`)(\2?)([^<]*?)\2\8(?!\2)(?=\W|_|$)/g,a=/^.*\n( *\|( *:?-+:?-+:? *\|)* *\n|)/,c=/.*\n/g,m=/\||(.*?[^\\])\|/g;const l=(t,n)=>{e=e.replace(t,n)},d=(e,t)=>"<"+e+">"+t+"</"+e+">",r=e=>e.replace(n,((e,t)=>d("blockquote",r(u(t.replace(/^ *&gt; */gm,"")))))),s=e=>e.replace(i,((e,t,n,i,o,a)=>(e=d("li",u(a.split(RegExp("\n ?"+t+"(?:(?:\\d+|[a-zA-Z])[.)]|[*\\-+]) +","g")).map(s).join("</li><li>"))),"\n"+(n?'<ol start="'+(i?n+'">':parseInt(n,36)-9+'" style="list-style-type:'+(o?"low":"upp")+'er-alpha">')+e+"</ol>":d("ul",e))))),u=e=>e.replace(o,((e,t,n,i,o,a,c,m,l,r)=>t+d(i?l?"strong":"em":o?l?"s":"sub":a?"sup":c?"small":m?"big":"code",u(r))));var p=[],h=0;return e="\n"+e+"\n",l(/</g,"&lt;"),l(/>/g,"&gt;"),l(/\t|\r|\uf8ff/g,"  "),e=r(e),l(/^([*\-=_] *){3,}$/gm,"<hr/>"),e=s(e),l(/<\/(ol|ul)>\n\n<\1>/g,""),l(/\n((```|~~~).*\n?([^]*?)\n?\2|((    .*?\n)+))/g,((e,t,n,i,o)=>(p[--h]=d("pre",d("code",i||o.replace(/^    /gm,""))),h+""))),l(/((!?)\[(.*?)\]\((.*?)( ".*")?\)|\\([\\`*_{}\[\]()#+\-.!~]))/g,((e,n,i,o,a,c,m)=>(p[--h]=a?i?'<img src="'+a+'" alt="'+o+'"/>':'<a href="'+a+'">'+u(o).replace(t,"$1")+"</a>":m,h+""))),l(/&lt;(.*?)&gt;/g,((e,n)=>'<a href="'+n+'">'+u(n).replace(t,"$1")+"</a>")),l(/\n(( *\|.*?\| *\n)+)/g,((e,n)=>{var i=n.match(a)[1];return"\n"+d("table",n.replace(c,((e,n)=>e==i?"":d("tr",e.replace(m,((e,o,a)=>a?d(i&&!n?"th":"td",u(o||"").replace(t,"$1")):""))))))})),l(/(?=^|>|\n)([>\s]*?)(#{1,6}) (.*?)( #*)? *(?=\n|$)/g,((e,n,i,o)=>n+d("h"+i.length,u(o).replace(t,"$1")))),l(/(?=^|>|\n)\s*\n+([^<]+?)\n+\s*(?=\n|<|$)/g,((e,n)=>d("p",u(n).replace(t,"$1")))),l(/-\d+\uf8ff/g,(e=>p[parseInt(e,10)])),e.trim()},f=e=>{let t=t=>e.next(t),n=t=>e.throw(t);return new Promise(((i,o)=>{let a=e=>{e.done?i(e.value):Promise.resolve(e.value).then(t,n).then(a,o)};a(e.next())}))};let g;const m=document.getElementById("comments-issue-id").innerText,n=new URL(window.location.href);let q,p=n.searchParams.get("github_access_token");p&&(document.cookie=`github_access_token=${p};Path=/;Secure;SameSite=Strict`,n.searchParams.delete("github_access_token"),window.location.replace(n)),null!=p||(p=null==(q=document.cookie.split(";").find((e=>e.trim().startsWith("github_access_token="))))?void 0:q.trim().substring(20));const r=()=>{document.cookie="github_access_token=;expires=Thu, 01 Jan 1970 00:00:00 GMT;Path=/;Secure;SameSite=Strict",p=null},t=()=>f(function*(){var e;let n;if(g=JSON.parse(null!=(n=null==(e=document.getElementById("comments-addition"))?void 0:e.innerText)?n:"[]"),p){if(200!==(e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"GET"})).status)return r(),yield t()}else e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}`,{method:"GET"});200===e.status&&(g=g.concat(yield e.json()))}()),u=()=>{g.sort(((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()));let e=document.getElementById("comment-list");e.innerHTML="";var t=document.createElement("div");for(t.id="comment-header",t.innerText="Comments",e.appendChild(t),0===g.length&&((t=document.createElement("div")).id="comment-tip",t.innerText="No comment yet",e.appendChild(t)),t=0;t<g.length;t++){let o=document.createElement("li");var n=document.createElement("div");n.id="comment-info";var i=document.createElement("img");i.id="comment-avatar",i.src=g[t].user.avatar_url,n.appendChild(i),(i=document.createElement("a")).id="comment-author",i.innerText=g[t].user.login,g[t].user.html_url&&(i.href=g[t].user.html_url),n.appendChild(i),(i=document.createElement("div")).id="comment-datetime",i.innerText=new Date(g[t].created_at).toLocaleString(),n.appendChild(i),o.appendChild(n),(n=document.createElement("div")).id="comment-body",n.innerHTML=y(g[t].body),o.appendChild(n),e.appendChild(o)}},v=()=>f(function*(){let e=document.getElementById("comment-action");e.innerHTML="";var n=document.createElement("div");if(n.id="comment-header",n.innerText="Leave a comment",e.appendChild(n),p){if(200===(n=yield fetch(`https://comments.eaimty.com/userinfo?github_access_token=${p}`,{method:"GET"})).status){n=yield n.json();let o=document.createElement("div");o.id="comment-action-info";var i=document.createElement("img");i.id="comment-action-avatar",i.src=n.avatar_url,o.appendChild(i),(i=document.createElement("a")).id="comment-action-author",i.innerText=n.login,i.href=n.html_url,o.appendChild(i);let a=document.createElement("button");a.id="comment-action-logout",a.innerText="Logout",a.addEventListener("click",(()=>{r(),v()})),o.appendChild(a),e.appendChild(o),(n=document.createElement("div")).id="comment-tip",n.innerText="Before commenting, please think about whether your comment is meaningful? Is it related to the topic? Is it rational and friendly? If you were someone else, would you feel uncomfortable seeing this comment?",e.appendChild(n),(n=document.createElement("div")).id="comment-action-input";let c=document.createElement("textarea");c.id="comment-action-textarea",c.placeholder="Leave a comment",n.appendChild(c);let l=document.createElement("button");return l.id="comment-action-post",l.innerText="Comment",l.addEventListener("click",(()=>f(function*(){a.disabled=!0,c.disabled=!0,l.disabled=!0;let e=c.value.trim();0!==e.length&&(201===(yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"POST",body:JSON.stringify({body:e})})).status?t().then((()=>u())).then((()=>v())):(r(),yield v(),window.alert("Failed to post comment")))}()))),n.appendChild(l),void e.appendChild(n)}r()}(n=document.createElement("div")).id="comment-tip",n.innerText="Clicking the login button means you agree to use cookies to store your GitHub Access Token",e.appendChild(n),(n=document.createElement("button")).id="comment-action-login",n.innerText="Login with GitHub",n.addEventListener("click",(()=>window.location.replace(`https://comments.eaimty.com/login?redirect_uri=${window.location.href}`))),e.appendChild(n)}());t().then((()=>u())).then((()=>v()))</script></div>