<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=#000000 id=color_chrome name=theme-color><meta content=#000000 id=color_safari name=apple-mobile-web-app-status-bar-style><meta content="EAimTY's Blog" name=description><link rel="Shortcut Icon" href=https://www.eaimty.com/favicon.ico><link href=https://www.eaimty.com/favicon.ico rel=Bootmark><link title="EAimTY's Blog" href=https://www.eaimty.com/rss.xml rel=alternate type=application/rss+xml><style>#title,body{line-height:1.6em}body{background:#000;color:#00c000;font-size:1.2em}#container{margin:2.4em auto;width:72%}#header{text-align:center}#header>a{font-size:.96em;margin:auto 1em}#title{font-size:1.6em;font-weight:700;margin:1em auto}#date{font-style:italic}#list>li{margin:.8em auto;list-style:disc}img{max-width:100%}a{color:inherit;text-decoration:none}#content a,a:hover{text-decoration:underline}pre{padding:1em;overflow:auto;background:#1b1d16}:not(pre) >code{padding:.2em;background:#1b1d16;overflow:auto}blockquote{padding:0 1em;margin:0;border-left:.25em solid #212121}@media (max-width:600px){#container{width:88%}#header>a{margin:auto .3em}}</style><title>Debian ä¸‹ç¼–è¯‘ linux-image ä¸ linux-headers çš„ DEB åŒ… - EAimTY's Blog</title><body><div id=header><a href=https://www.eaimty.com>EAimTY's Blog</a><a href=https://www.eaimty.com/about/>About</a><a href=https://www.eaimty.com/friends/>Friends</a></div><div id=container><a href=https://www.eaimty.com/2016/debian-compile-kernel-image-and-headers-deb/ id=title>Debian ä¸‹ç¼–è¯‘ linux-image ä¸ linux-headers çš„ DEB åŒ…</a><div id=date>2016-06-20</div><div id=content><p><strong>2018å¹´2æœˆ2æ—¥æ³¨ï¼šå…¶å®å‡çº§ Debian å†…æ ¸çš„æœ€å¥½æ–¹æ³•ï¼Œå°±æ˜¯æ¢ç”¨ Debian sid...çœå»äº†å¾ˆå¤šéº»çƒ¦ï¼Œå†µä¸” sid åœ¨ç¨³å®šæ€§ä¸Šä¹Ÿä¸ç®—å·®ã€‚</strong><p>æœ€è¿‘ç”¨äº†å‡ å¤© win10ï¼Œç»“æœè¢«æ¶å¿ƒåˆ°äº†ã€‚å…·ä½“å°±ä¸è¯´äº†ï¼Œæ€»ä¹‹å°±æ˜¯å„ç§å„æ ·çš„åƒåœ¾ã€å„ç§å„æ ·çš„ä¸å’Œè°ã€‚<p>æƒ¹ä¸èµ·æƒ¹ä¸èµ·ï¼Œæˆ‘è¿˜æ˜¯æ»šå› Linux å§ã€‚<p>é‡æ–°å›åˆ°ç†Ÿæ‚‰çš„ Debian+Gnome ç¯å¢ƒï¼Œçªå‘å¥‡æƒ³å‡†å¤‡å‡çº§ä¸€ä¸‹å†…æ ¸ã€‚äºæ˜¯æŠ˜è…¾äº†åŠå¤©ï¼ŒæŠŠå†…æ ¸å‡çº§åˆ°äº† 4.6.2ã€‚ æˆ–è®¸æ˜¯ Debian 8 çš„é»˜è®¤å†…æ ¸å¤ªå¤è€ï¼ˆ3.xï¼‰ï¼ˆCentOS 6 è¡¨ç¤ºä¸æœï¼‰ï¼Œä¹Ÿå¯èƒ½æ˜¯å¿ƒç†ä½œç”¨ï¼Œæ„Ÿè§‰ 4.x è¿è¡Œèµ·æ¥çš„ç¡®æ¯” 3.x å¿«äº†ä¸å°‘ï¼Œäºæ˜¯æ‰‹è´±ç›´æ¥æŠŠæ—§å†…æ ¸ remove æ‰äº†ï¼Œè€Œä¸”è¿˜åŠ äº† purge...(+_+)<p>ä½†æ²¡è¿‡å¤šé•¿æ—¶é—´ï¼Œå°±å‘ç°äº†é—®é¢˜ï¼šVirtualBox æ— æ³•å¯åŠ¨è™šæ‹Ÿæœº...æŸ¥äº†ä¸€ä¸‹ logï¼Œå‘ç°åŸæ¥æ˜¯ VirtualBox Kernel Modules å‡ºäº†é—®é¢˜ï¼š VirtualBox Kernel Modules éœ€è¦é€šè¿‡ DKMS ä½¿ç”¨ linux-headersï¼Œè€Œæˆ‘å·²ç»æŠŠæ—§ç‰ˆæœ¬çš„ linux-image å’Œ linux-headers éƒ½ purge æ‰äº†ã€‚ç„¶è€Œé€šè¿‡ aptï¼Œæ— è®ºç”¨ testing æºè¿˜æ˜¯ sid(unstable) æºéƒ½æ— æ³•ç›´æ¥å®‰è£…å¯¹åº”æ–°ç‰ˆæœ¬ï¼ˆä¹Ÿå°±æ˜¯æˆ‘è£…çš„ 4.6.2 ç‰ˆï¼‰çš„ linux-headers åŒ…ã€‚<p><del>è›‹ç¢ä¸€åœ°...Î£(ï¾ŸĞ”ï¾Ÿ)</del><p>é€šè¿‡ Google åˆ°çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ <code>make headers_install</code>ï¼ŒDKMS ä»ç„¶æŠ¥é”™... æ²¡åŠæ³•äº†ï¼Œé‡è£… Debian...<p>é¡ºä¾¿å‘ç°äº†ä¸€ä¸ªåˆ¶ä½œ Debian å®‰è£… U ç›˜çš„å¥½æ–¹æ³•æ–¹æ³•ï¼Œåªéœ€ä¸¤æ¡å‘½ä»¤å³å¯ï¼š<p><code>$ sudo cat debian.iso > /dev/sdb</code><p><code>$ sudo sync</code><p>æŠŠè¿™é‡Œçš„ <code>debian.iso</code> æ¢æˆå®‰è£…é•œåƒçš„åç§°ï¼Œä¿è¯ <code>/dev/sdb</code> æ˜¯ä½ çš„Uç›˜<p>æ–°ç³»ç»Ÿè£…å¥½åæ²¡å¤šé•¿æ—¶é—´ï¼Œæ‰‹è´±åˆå‘ä½œäº†ï¼ŒåˆæŠŠ Kernel å‡çº§åˆ°äº† 4.6.2ï¼ˆæˆ‘çœŸæ˜¯æ²¡æ•‘äº†ï¼‰ã€‚ä¸è¿‡è¿™æ¬¡å¸å–äº†ä¸Šæ¬¡çš„æ•™è®­ï¼ŒæŠ˜è…¾äº†åŠå¤©ï¼Œæ‰¾åˆ°ä¸€ç§ç›´æ¥æŠŠ Kernel æºç ç¼–è¯‘æˆ linux-image å’Œ linux-headers çš„ DEB åŒ…çš„æ–¹æ³•ï¼Œä½¿ DKMS å¯ä»¥æ­£å¸¸ç¼–è¯‘ VirtualBox Kernel Modulesã€‚<del>è¿™å›èƒ½å¥½å¥½ç©äº†</del><p>é¦–å…ˆå®‰è£…æ‰€éœ€çš„å·¥å…·ï¼š<p><code>$ sudo apt-get install git fakeroot build-essential ncurses-dev xz-utils libssl-dev bc kernel-package</code><p>éœ€è¦ä¸‹è½½ 1GB å·¦å³çš„æ–‡ä»¶ï¼Œè€å¿ƒç­‰å§ã€‚<p>ä¸‹ä¸€æ­¥å½“ç„¶æ˜¯å» <a href=https://kernel.org/>kernel.org</a> ä¸‹è½½å†…æ ¸æºç ï¼Œæ¨èä¸‹è½½æœ€æ–°çš„ stable ç‰ˆï¼Œä¸‹è½½ .tar.xz æ ¼å¼çš„åŒ…å³å¯ã€‚ å½“ç„¶ï¼Œå›½å†…è¿æ¥ kernel.org çš„é€Ÿåº¦ä¸æ•¢æ­ç»´ï¼Œå¯ä»¥åˆ°<a href=https://mirrors.ustc.edu.cn/kernel.org/linux/kernel/v4.x/>ä¸­ç§‘å¤§çš„æº</a>ä¸‹è½½ã€‚<p>ç„¶åè§£å‹ï¼š<p><code>$ xz -d ***.tar.xz</code><p><code>$ tar -xvf ***.tar</code><p>é€šè¿‡ä¸Šé¢çš„ xz å‘½ä»¤å¯ä»¥æŠŠ .tar.xz è§£åŒ…æˆå¸¸è§çš„ .tarï¼Œç„¶åæŒ‰å¸¸è§„æ–¹å¼è§£å‹å³å¯ã€‚ ä¹‹å cd è¿›è§£å‹åçš„ç›®å½•ï¼Œè½¬åˆ° root ç”¨æˆ· å¯ä»¥æŒ‰ç…§ä½ çš„éœ€æ±‚æ”¹åŠ¨å†…æ ¸æ–‡ä»¶ã€‚<p>æ¸…ç†ä¸€ä¸‹ä¹‹å‰ç¼–è¯‘çš„æ–‡ä»¶ï¼š<p><code># make mrproper</code><p>ç”Ÿæˆ .config æ–‡ä»¶ï¼š<p><code># make menuconfig</code><p>è®¾ç½®å¥½é€‰é¡¹ï¼Œæœ€åé€‰ saveã€‚<p>æ¸…ç†ä¸€ä¸‹ï¼š<p><code># make-kpkg clean</code><p>ä¸‹é¢å¼€å§‹ç¼–è¯‘ debï¼š<p><code># fakeroot make-kpkg --initrd --revision=4.6.2-EAimTY kernel_image kernel_headers -j2</code><p>åœ¨è¿™å¥å‘½ä»¤ä¸­ï¼š <code>--initrd</code> è¡¨ç¤ºåˆ›å»º initrdï¼› <code>--revision=4.6.2-EAimTY</code> ä¸­çš„ <code>4.6.2-EAimTY</code> æ˜¯åˆ›å»ºçš„ deb åŒ…çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹ï¼› <code>kernel_image</code> è¡¨ç¤ºç¼–è¯‘ linux-image; <code>kernel_headers</code> è¡¨ç¤ºç¼–è¯‘ linux-headersï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥å»æ‰ï¼› <code>-j2</code> è¡¨ç¤ºä½¿ç”¨ä¸¤ä¸ª CPU æ ¸å¿ƒï¼Œå…·ä½“è§† CPU å‚æ•°è€Œå®šï¼Œä¸¾ä¸ªæ —å­ï¼šå‡å¦‚ä½ ç”¨çš„ CPU æ˜¯æœ€æ–°çš„ Intel Xeon E5 2699 v4ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰ 22 ä¸ªæ ¸å¿ƒï¼Œå°±æŠŠè¿™ä¸ªå‚æ•°æ¢æˆ <code>-j22</code>ï¼ˆä¸è¿‡è²Œä¼¼è¿™ä¸ªå‚æ•°æœ€å¤šæ”¯æŒåˆ° <code>-j9</code>...ï¼‰ æƒ³çŸ¥é“ä½ çš„ CPU æœ‰å‡ ä¸ªæ ¸å¿ƒï¼Œå¯ä»¥ä½¿ç”¨ <code>$ cat /proc/cpuinfo | grep "cpu cores"</code> æŸ¥çœ‹<p>ç»è¿‡æ¼«é•¿çš„ç­‰å¾…ï¼ˆæˆ‘åŒæ ¸ i5ï¼Œ4G å†…å­˜çš„ç¬”è®°æœ¬èŠ±äº†ä¸€ä¸ªå¤šå°æ—¶ï¼‰ï¼Œlinux-image å’Œ linux-header çš„ deb åŒ…å°±ä¼šå‡ºç°åœ¨ä¸Šå±‚ç›®å½•ä¸­äº†ã€‚ç”¨ <code>dpkg -i</code> å®‰è£…ã€‚<p>é‡å¯åï¼Œé€šè¿‡ GRUB é«˜çº§é€‰é¡¹ä¸­å°±ä¼šå‡ºç°æ–°çš„å†…æ ¸ï¼Œè¿›å…¥åï¼Œå¦‚æœæœ‰å¼ºè¿«ç—‡ï¼Œå¯ä»¥å¸è£…æ‰æ—§çš„å†…æ ¸ï¼š<p><code>$ sudo dpkg -l "linux-image*"</code><p><code>$ sudo dpkg -l "linux-headers*"</code><p>ä¸¤æ¡å‘½ä»¤ä¼šåˆ†åˆ«åˆ—å‡ºå·²å®‰è£…çš„ linux-image å’Œ linux-headersï¼Œå¯ä»¥ç”¨ apt åˆ æ‰ã€‚<p>é€šè¿‡ä»¥ä¸Šæ–¹æ³•å®‰è£… linux-image å’Œ linux-headers åï¼ŒVirtualBox ä»ç„¶å¯ä»¥å®Œç¾è¿è¡Œï¼Œåªéœ€è¦ç”¨ DKMS é‡æ–°ç”Ÿæˆä¸€ä¸‹ VirtualBox Kernel Modules å³å¯ã€‚</div><div id=comments-issue-id style=display:none>15</div><div id=comments-addition style=display:none>[{"user":{"login":"nrechn","html_url":"https://gyz.io","avatar_url":"https://secure.gravatar.com/avatar/9bcc01c06b1a3ccb58442236364e67c4?d=retro"},"created_at":"2016-07-14T23:32:05Z","body":"å†…æ ¸é…ç½®æ€ä¹ˆå¯ä»¥é»˜è®¤çš„å°±è¡Œï¼Ÿ#(æ»‘ç¨½)ï¼Œéš¾æ€ªæ³¥ä¼šç¼–è¯‘ä¸€ä¸ªå¤šå°æ—¶å‘¢ã€‚è€Œä¸”é»˜è®¤çš„å±…ç„¶èƒ½ç”¨èµ·æ¥ï¼Ÿï¼Ÿåæ­£æˆ‘é»˜è®¤çš„è¯æ ¹æœ¬å¯åŠ¨ä¸äº†ç³»ç»Ÿã€‚\n\nè¡¨ç¤ºä»æ¥éƒ½æ˜¯è‡ªå·±ä¿®æ”¹å†…æ ¸é…ç½®ï¼Œåˆšå¼€å§‹è¦æ4ä¸ªå°æ—¶é…ç½®å†…æ ¸ï¼Œç†Ÿæ‚‰ä¹‹åç›´æ¥æ²¿ç”¨åŸå…ˆçš„configï¼Œé‡æ–°é€‰çš„æ—¶å€™å‡­è®°å¿†å¤§æ¦‚10æ¥åˆ†é’Ÿèƒ½å‡ ä¹æŠŠæ‰€æœ‰é€‰é¡¹è¿‡ä¸€éã€‚ç„¶ååŒæ ¸i5ååˆ†é’Ÿç¼–è¯‘å¥½å†…æ ¸#(æ»‘ç¨½)\n\nå¦å¤–å®é™…ä¸Šæ²¡å¿…è¦è¿™ä¹ˆéº»çƒ¦å•¦ï¼Œåªè¦æŠŠlinux-headersåŒ…æ‰“å¼€æ¥çœ‹çœ‹ header files ä¸¢å“ªå„¿äº†ï¼Œç„¶åæŠŠç¼–è¯‘å†…æ ¸çš„ä¸´æ—¶ç›®å½•linkè¿‡å»å³å¯ï¼Œæ‰“åŒ…ä»€ä¹ˆçš„å¤šéº»çƒ¦ #(æ»‘ç¨½)"},{"user":{"login":"frytea","html_url":"https://www.frytea.com","avatar_url":"https://secure.gravatar.com/avatar/efe8762bf0cd029d0a6d24e0faf47adf?d=retro"},"created_at":"2021-11-15T02:46:45Z","body":"`sudo cat debian.iso > /dev/sdb` è¿™ä¸ªçœŸæ˜¯å­¦åˆ°äº†ï¼Œæ”¹æ—¥è¯•è¯•"},{"user":{"login":"å››æ–‹ç ´ä¹™poi","avatar_url":"https://secure.gravatar.com/avatar/a0b790504103d79d05eda548601ca033?d=retro"},"created_at":"2017-03-18T06:20:06Z","body":"æˆ‘åªæ˜¯ä»åŸºä½¬äº‘éŸ³ä¹è¿‡æ¥é€›é€›çš„"},{"user":{"login":"EAimTY","html_url":"https://www.eaimty.com/","avatar_url":"https://secure.gravatar.com/avatar/f64037e002ad7b01fe9ee60351bfd1d2?d=retro"},"created_at":"2016-07-15T14:35:18Z","body":"> å†…æ ¸é…ç½®æ€ä¹ˆå¯ä»¥é»˜è®¤çš„å°±è¡Œï¼Ÿ#(æ»‘ç¨½)ï¼Œéš¾æ€ªæ³¥ä¼šç¼–è¯‘ä¸€ä¸ªå¤šå°æ—¶å‘¢ã€‚è€Œä¸”é»˜è®¤çš„å±…ç„¶èƒ½ç”¨èµ·æ¥ï¼Ÿï¼Ÿåæ­£æˆ‘é»˜è®¤çš„è¯æ ¹æœ¬å¯åŠ¨ä¸äº†ç³»ç»Ÿã€‚\n> \n> è¡¨ç¤ºä»æ¥éƒ½æ˜¯è‡ªå·±ä¿®æ”¹å†…æ ¸é…ç½®ï¼Œåˆšå¼€å§‹è¦æ4ä¸ªå°æ—¶é…ç½®å†…æ ¸ï¼Œç†Ÿæ‚‰ä¹‹åç›´æ¥æ²¿ç”¨åŸå…ˆçš„configï¼Œé‡æ–°é€‰çš„æ—¶å€™å‡­è®°å¿†å¤§æ¦‚10æ¥åˆ†é’Ÿèƒ½å‡ ä¹æŠŠæ‰€æœ‰é€‰é¡¹è¿‡ä¸€éã€‚ç„¶ååŒæ ¸i5ååˆ†é’Ÿç¼–è¯‘å¥½å†…æ ¸#(æ»‘ç¨½)\n> \n> å¦å¤–å®é™…ä¸Šæ²¡å¿…è¦è¿™ä¹ˆéº»çƒ¦å•¦ï¼Œåªè¦æŠŠlinux-headersåŒ…æ‰“å¼€æ¥çœ‹çœ‹ header files ä¸¢å“ªå„¿äº†ï¼Œç„¶åæŠŠç¼–è¯‘å†…æ ¸çš„ä¸´æ—¶ç›®å½•linkè¿‡å»å³å¯ï¼Œæ‰“åŒ…ä»€ä¹ˆçš„å¤šéº»çƒ¦ #(æ»‘ç¨½)\n\nçš„ç¡®èƒ½ç”¨ï¼Œä½†é—®é¢˜çš„ç¡®å¾ˆå¤š...ğŸ˜…ä¸è¿‡æœ€è¿‘ä»¥æ¢Archäº†ï¼Œå°±ä¸å­˜åœ¨è¿™ç§é—®é¢˜äº†ğŸ˜‚å¦å¤–ï¼Œæˆ‘çš„i5å¯æ˜¯ç¾è´µçš„ç¬¬ä¸€ä»£i5-560Mï¼Œèƒ½æµç•…è¿è¡Œæ‰«é›·ğŸ˜‚"}]</div><style>#comment-header,#comment-list>li{margin:1em auto}#comment-avatar,#comment-tip{margin:auto .2em}#comment-action-avatar,#comment-avatar{width:1em;height:1em}#comment-action-info>*,#comment-action-input>*,#comment-info>*{display:inline-block;vertical-align:middle}#comment-header{font-size:1.6em;font-weight:700;line-height:1.6em}#comment-tip{font-style:italic}#comment-list{list-style:none;padding:0}#comment-action-author,#comment-author{font-weight:700;margin:auto .4em}#comment-datetime{font-size:.8em;font-style:italic}#comment-body{margin:auto 1.8em}#comment-action-info>*{margin:1em .2em}#comment-action-input{height:2em;width:100%;margin:1em auto}#comment-action-input>*{height:100%;margin:0 .2em}#comment-action-textarea{width:calc(100% - 8em)}#comment-action-post{width:6em}#comment-action-login{margin:1em .3em}</style><ol id=comment-list></ol><div id=comment-action></div><script>const y=e=>{var t=/\\([\\\|`*_{}\[\]()#+\-~])/g,n=/\n *&gt; *([^]*?)(?=(\n|$){2})/g,i=/\n( *)(?:[*\-+]|((\d+)|([a-z])|[A-Z])[.)]) +([^]*?)(?=(\n|$){2})/g,o=/(^|[^A-Za-z\d\\])(([*_])|(~)|(\^)|(--)|(\+\+)|`)(\2?)([^<]*?)\2\8(?!\2)(?=\W|_|$)/g,a=/^.*\n( *\|( *:?-+:?-+:? *\|)* *\n|)/,c=/.*\n/g,m=/\||(.*?[^\\])\|/g;const l=(t,n)=>{e=e.replace(t,n)},d=(e,t)=>"<"+e+">"+t+"</"+e+">",r=e=>e.replace(n,((e,t)=>d("blockquote",r(u(t.replace(/^ *&gt; */gm,"")))))),s=e=>e.replace(i,((e,t,n,i,o,a)=>(e=d("li",u(a.split(RegExp("\n ?"+t+"(?:(?:\\d+|[a-zA-Z])[.)]|[*\\-+]) +","g")).map(s).join("</li><li>"))),"\n"+(n?'<ol start="'+(i?n+'">':parseInt(n,36)-9+'" style="list-style-type:'+(o?"low":"upp")+'er-alpha">')+e+"</ol>":d("ul",e))))),u=e=>e.replace(o,((e,t,n,i,o,a,c,m,l,r)=>t+d(i?l?"strong":"em":o?l?"s":"sub":a?"sup":c?"small":m?"big":"code",u(r))));var p=[],h=0;return e="\n"+e+"\n",l(/</g,"&lt;"),l(/>/g,"&gt;"),l(/\t|\r|\uf8ff/g,"  "),e=r(e),l(/^([*\-=_] *){3,}$/gm,"<hr/>"),e=s(e),l(/<\/(ol|ul)>\n\n<\1>/g,""),l(/\n((```|~~~).*\n?([^]*?)\n?\2|((    .*?\n)+))/g,((e,t,n,i,o)=>(p[--h]=d("pre",d("code",i||o.replace(/^    /gm,""))),h+"ï£¿"))),l(/((!?)\[(.*?)\]\((.*?)( ".*")?\)|\\([\\`*_{}\[\]()#+\-.!~]))/g,((e,n,i,o,a,c,m)=>(p[--h]=a?i?'<img src="'+a+'" alt="'+o+'"/>':'<a href="'+a+'">'+u(o).replace(t,"$1")+"</a>":m,h+"ï£¿"))),l(/&lt;(.*?)&gt;/g,((e,n)=>'<a href="'+n+'">'+u(n).replace(t,"$1")+"</a>")),l(/\n(( *\|.*?\| *\n)+)/g,((e,n)=>{var i=n.match(a)[1];return"\n"+d("table",n.replace(c,((e,n)=>e==i?"":d("tr",e.replace(m,((e,o,a)=>a?d(i&&!n?"th":"td",u(o||"").replace(t,"$1")):""))))))})),l(/(?=^|>|\n)([>\s]*?)(#{1,6}) (.*?)( #*)? *(?=\n|$)/g,((e,n,i,o)=>n+d("h"+i.length,u(o).replace(t,"$1")))),l(/(?=^|>|\n)\s*\n+([^<]+?)\n+\s*(?=\n|<|$)/g,((e,n)=>d("p",u(n).replace(t,"$1")))),l(/-\d+\uf8ff/g,(e=>p[parseInt(e,10)])),e.trim()},f=e=>{let t=t=>e.next(t),n=t=>e.throw(t);return new Promise(((i,o)=>{let a=e=>{e.done?i(e.value):Promise.resolve(e.value).then(t,n).then(a,o)};a(e.next())}))};let g;const m=document.getElementById("comments-issue-id").innerText,n=new URL(window.location.href);let q,p=n.searchParams.get("github_access_token");p&&(document.cookie=`github_access_token=${p};Path=/;Secure;SameSite=Strict`,n.searchParams.delete("github_access_token"),window.location.replace(n)),null!=p||(p=null==(q=document.cookie.split(";").find((e=>e.trim().startsWith("github_access_token="))))?void 0:q.trim().substring(20));const r=()=>{document.cookie="github_access_token=;expires=Thu, 01 Jan 1970 00:00:00 GMT;Path=/;Secure;SameSite=Strict",p=null},t=()=>f(function*(){var e;let n;if(g=JSON.parse(null!=(n=null==(e=document.getElementById("comments-addition"))?void 0:e.innerText)?n:"[]"),p){if(200!==(e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"GET"})).status)return r(),yield t()}else e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}`,{method:"GET"});200===e.status&&(g=g.concat(yield e.json()))}()),u=()=>{g.sort(((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()));let e=document.getElementById("comment-list");e.innerHTML="";var t=document.createElement("div");for(t.id="comment-header",t.innerText="Comments",e.appendChild(t),0===g.length&&((t=document.createElement("div")).id="comment-tip",t.innerText="No comment yet",e.appendChild(t)),t=0;t<g.length;t++){let o=document.createElement("li");var n=document.createElement("div");n.id="comment-info";var i=document.createElement("img");i.id="comment-avatar",i.src=g[t].user.avatar_url,n.appendChild(i),(i=document.createElement("a")).id="comment-author",i.innerText=g[t].user.login,g[t].user.html_url&&(i.href=g[t].user.html_url),n.appendChild(i),(i=document.createElement("div")).id="comment-datetime",i.innerText=new Date(g[t].created_at).toLocaleString(),n.appendChild(i),o.appendChild(n),(n=document.createElement("div")).id="comment-body",n.innerHTML=y(g[t].body),o.appendChild(n),e.appendChild(o)}},v=()=>f(function*(){let e=document.getElementById("comment-action");e.innerHTML="";var n=document.createElement("div");if(n.id="comment-header",n.innerText="Leave a comment",e.appendChild(n),p){if(200===(n=yield fetch(`https://comments.eaimty.com/userinfo?github_access_token=${p}`,{method:"GET"})).status){n=yield n.json();let o=document.createElement("div");o.id="comment-action-info";var i=document.createElement("img");i.id="comment-action-avatar",i.src=n.avatar_url,o.appendChild(i),(i=document.createElement("a")).id="comment-action-author",i.innerText=n.login,i.href=n.html_url,o.appendChild(i);let a=document.createElement("button");a.id="comment-action-logout",a.innerText="Logout",a.addEventListener("click",(()=>{r(),v()})),o.appendChild(a),e.appendChild(o),(n=document.createElement("div")).id="comment-tip",n.innerText="Before commenting, please think about whether your comment is meaningful? Is it related to the topic? Is it rational and friendly? If you were someone else, would you feel uncomfortable seeing this comment?",e.appendChild(n),(n=document.createElement("div")).id="comment-action-input";let c=document.createElement("textarea");c.id="comment-action-textarea",c.placeholder="Leave a comment",n.appendChild(c);let l=document.createElement("button");return l.id="comment-action-post",l.innerText="Comment",l.addEventListener("click",(()=>f(function*(){a.disabled=!0,c.disabled=!0,l.disabled=!0;let e=c.value.trim();0!==e.length&&(201===(yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"POST",body:JSON.stringify({body:e})})).status?t().then((()=>u())).then((()=>v())):(r(),yield v(),window.alert("Failed to post comment")))}()))),n.appendChild(l),void e.appendChild(n)}r()}(n=document.createElement("div")).id="comment-tip",n.innerText="Clicking the login button means you agree to use cookies to store your GitHub Access Token",e.appendChild(n),(n=document.createElement("button")).id="comment-action-login",n.innerText="Login with GitHub",n.addEventListener("click",(()=>window.location.replace(`https://comments.eaimty.com/login?redirect_uri=${window.location.href}`))),e.appendChild(n)}());t().then((()=>u())).then((()=>v()))</script></div>