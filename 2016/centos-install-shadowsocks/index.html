<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=#000000 id=color_chrome name=theme-color><meta content=#000000 id=color_safari name=apple-mobile-web-app-status-bar-style><meta content="EAimTY's Blog" name=description><link rel="Shortcut Icon" href=https://www.eaimty.com/favicon.ico><link href=https://www.eaimty.com/favicon.ico rel=Bootmark><link title="EAimTY's Blog" href=https://www.eaimty.com/rss.xml rel=alternate type=application/rss+xml><style>#title,body{line-height:1.6em}body{background:#000;color:#00c000;font-size:1.2em}#container{margin:2.4em auto;width:72%}#header{text-align:center}#header>a{font-size:.96em;margin:auto 1em}#title{font-size:1.6em;font-weight:700;margin:1em auto}#date{font-style:italic}#list>li{margin:.8em auto;list-style:disc}img{max-width:100%}a{color:inherit;text-decoration:none}#content a,a:hover{text-decoration:underline}pre{padding:1em;overflow:auto;background:#1b1d16}:not(pre) >code{padding:.2em;background:#1b1d16;overflow:auto}blockquote{padding:0 1em;margin:0;border-left:.25em solid #212121}@media (max-width:600px){#container{width:88%}#header>a{margin:auto .3em}}</style><title>CentOS 7 ä¸‹æ­å»º Shadowsocks æœåŠ¡å™¨ - EAimTY's Blog</title><body><div id=header><a href=https://www.eaimty.com>EAimTY's Blog</a><a href=https://www.eaimty.com/about/>About</a><a href=https://www.eaimty.com/friends/>Friends</a></div><div id=container><a href=https://www.eaimty.com/2016/centos-install-shadowsocks/ id=title>CentOS 7 ä¸‹æ­å»º Shadowsocks æœåŠ¡å™¨</a><div id=date>2016-02-05</div><div id=content><p><strong>æœ¬æ–‡æ›´æ–°äº 2017 å¹´ 11 æœˆ 10 æ—¥ï¼Œ0x13 å¤§ä¹‹åçš„å‡ æ—¥</strong><p>ä» 2017 å¹´ç§‹å­£å¼€å§‹ï¼Œå¢™çš„å‡çº§é€Ÿåº¦ä¸æ–­å˜å¿«ï¼ŒåŒæ—¶è¿˜åŠ¨ç”¨äº†ä¸å°‘ç‰©ç†æ‰‹æ®µï¼Œçº¦è°ˆäº†ä¸€äº›ç›¸å…³äººå£«ã€‚ ä¸Šæ¬¡æ›´æ–°æœ¬æ–‡å·²ç»æ˜¯ä¸€å¹´åŠä¹‹å‰äº†ï¼Œå…¶ä¸­ç”¨ PPTP ç¿»è¶Šé•¿åŸçš„æ–¹æ³•å·²ç»å½»åº•æŒ‚æ‰ã€‚ä¹‹å‰å¾ˆå¤šå¸¸ç”¨çš„ ss åŠ å¯†ç®—æ³•ä¹Ÿå˜å¾—ä¸å†å®‰å…¨ï¼Œæ‰€ä»¥æ˜¯æ—¶å€™æ›´æ–°ä¸€ä¸‹æ–‡ç« äº†ã€‚<h1 id=guan-yu-xi-tong>å…³äºç³»ç»Ÿ</h1><p>é™¤éæœ‰ç‰¹æ®Šéœ€è¦ï¼Œå»ºè®®ä½¿ç”¨çš„æ‰€æœ‰è½¯ä»¶ã€ç³»ç»Ÿçš„æœ€æ–°ç¨³å®šç‰ˆæœ¬å¹¶æŒç»­æ›´æ–°ï¼Œæ¥ä¿è¯å®‰å…¨æ€§ã€‚ è¿™é‡Œé€‰ç”¨ CentOS 7 ä½œä¸ºç³»ç»Ÿã€‚<p>å¦‚æœä½ çš„æœºå™¨æ˜¯ KVM æˆ–å…¶å®ƒæ”¯æŒæ›´æ¢å†…æ ¸çš„æ¶æ„ï¼Œå¼ºçƒˆå»ºè®®æŠŠå†…æ ¸å‡çº§åˆ° 4.9 ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œå¹¶å¼€å¯ <a href=https://github.com/google/bbr>tcp bbr</a> æ‹¥å µæ§åˆ¶ç®—æ³•ï¼Œåœ¨å¤šæ•°ç½‘ç»œæƒ…å†µä¸‹ï¼ˆç‰¹åˆ«æ˜¯ä¸¢åŒ…ç‡é«˜æ—¶ï¼‰å¯ä»¥å¤§å¹…åº¦æå‡è¿æ¥é€Ÿåº¦å’Œç¨³å®šæ€§ã€‚å¼€å¯ bbr ç®—æ³•çš„æ–¹å¼å¯ä»¥å‚è€ƒ<a href=https://www.isthnew.com/centos7-bbr/>è¿™ç¯‡æ–‡ç« </a>ã€‚<h1 id=an-zhuang-ruan-jian-bao>å®‰è£…è½¯ä»¶åŒ…</h1><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹© Shadowsocks æœ€æ­£ç»Ÿçš„ Python åˆ†æ”¯ã€‚ é¦–å…ˆéœ€è¦å®‰è£… pipï¼Œä½† CentOS å®˜æ–¹çš„ yum æºä¸­å¹¶æ²¡æœ‰ pipï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå®‰è£… EPEL æºï¼š<p><code># yum install epel-release</code><p>å¾…å®‰è£…å®Œåï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥å®‰è£… pipï¼š<p><code># yum install python-pip</code><p>è™½ç„¶å®‰è£…å¥½äº† pipï¼Œä½† pip æºä¸­çš„ Shadowsocks çš„ç‰ˆæœ¬å·²ç»éå¸¸è€äº†ï¼ŒæŸ¥é˜… Shadowsocks Wiki åæ‰¾åˆ°äº†æ­£ç¡®çš„å®‰è£…å§¿åŠ¿ï¼š<p><code># pip install git+https://github.com/shadowsocks/shadowsocks.git@master</code><p>Shadowsocks å¯ä»¥ä½¿ç”¨å¤šç§åŠ å¯†ç®—æ³•ï¼Œè€Œç°åœ¨å®‰å…¨æ€§æ¯”è¾ƒå¼ºçš„ç®—æ³•åŸºæœ¬ä¸Šéƒ½éœ€è¦ libsodium åº“ï¼š<p><code># yum install libsodium</code><p>å®‰è£…å®Œæˆã€‚<h1 id=pei-zhi-shadowsocks>é…ç½® Shadowsocks</h1><p>è¿™ä¸€æ­¥ååˆ†ç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„ä¸æ˜¯ Shadowsocks å¤šç”¨æˆ·ç‰ˆï¼Œæ‰€ä»¥åªéœ€è¦ä¸€è¡Œå‘½ä»¤å³å¯è§£å†³ï¼š<p><code># ssserver -p ç«¯å£å· -k å¯†ç  -m åŠ å¯†æ–¹å¼ -d start</code><p>åœ¨è¿™é‡Œï¼Œç«¯å£å·æ¨èä½¿ç”¨æœ€å¸¸ç”¨çš„å‡ ä¸ªï¼ˆä¾‹å¦‚ 443ã€8080 ç­‰ï¼‰é˜²æ­¢è¢«é˜²ç«å¢™ç‰¹æ®Šç…§é¡¾ï¼ŒåŠ å¯†æ–¹å¼æ¨è chacha20-ietf-poly1305ï¼Œå¤§å¤šæ•°å…¶å®ƒç®—æ³•ç°åœ¨éƒ½å·²ç»å˜å¾—ä¸å®‰å…¨äº†ã€‚<p>ä¸¾ä¸ªæ —å­ï¼Œå‡å¦‚æˆ‘ä»¬ä½¿ç”¨ 443 ç«¯å£ï¼ŒåŠ å¯†æ–¹å¼é€‰ rc4-md5ï¼Œå°±æ‰§è¡Œï¼š<p><code># ssserver -p 443 -k å¯†ç  -m rc4-md5 -d start</code><p>ä½†è¿™æ ·å¯åŠ¨ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œå› ä¸ºåœ¨ SSH è¿æ¥ä¸­æ–­åï¼Œåœ¨è¿™ä¸ªè¿æ¥å†…å¯åŠ¨çš„è¿›ç¨‹ä¹Ÿä¼šè¢«æ€æ‰ã€‚ å¯ä»¥æŠŠ ss çš„è¿›ç¨‹æ”¾è¿›ä¸€ä¸ªä¸“ç”¨çš„ screen ä¸­æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ screen è¿™ä¸ªè½¯ä»¶åŒ…ï¼š<p><code># yum install screen</code><p>ç„¶åæ–°å»ºä¸€ä¸ªåå­—å« shadowsocks çš„ screenï¼š<p><code># screen -S shadowsocks</code><p>è¿›å…¥æ–°çš„ screen åï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰æ­£å¸¸æ–¹å¼å¯åŠ¨ shadowsocksï¼Œç„¶åæŒ‰ Ctrl+A å†æŒ‰ D é”®æŠŠ screen æ”¾è¿›åå°ã€‚ è¿™æ · ss å°±åœ¨åå°è·‘èµ·æ¥äº†ã€‚ ï¼ˆæƒ³è¦é‡æ–°è°ƒå‡ºè¿™ä¸ª screen çª—å£ï¼Œæ‰§è¡Œ <code># screen -r shadowsocks</code> å³å¯ï¼‰<h1 id=kai-ji-zi-qi>å¼€æœºè‡ªå¯</h1><p>CentOS 7 æœ€å¤§çš„å˜åŒ–åº”è¯¥å°±æ˜¯æŠŠ init.d æ¢æˆäº† systemdï¼Œæ‰€ä»¥ä¸å¤ªæ¨èå†ä½¿ç”¨ rc.local è„šæœ¬çš„æ–¹å¼è®© ss å¼€æœºè‡ªå¯ï¼Œæ­£ç¡®å§¿åŠ¿åº”è¯¥æ˜¯ç”¨ systemctl æ§åˆ¶å¯åŠ¨ã€‚<p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ª ss çš„é…ç½®æ–‡ä»¶å·²ä¾¿äºä¹‹åçš„æ“ä½œï¼Œæ–°å»ºä¸€ä¸ª <code>/etc/shadowsocks.json</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š<pre class=language-json data-lang=json><code class=language-json data-lang=json>{
  "server": "0.0.0.0",
  "port_password": {
    "ç«¯å£ 1": "ç«¯å£ 1 å¯†ç ",
    "ç«¯å£ 2": "ç«¯å£ 2 å¯†ç ",
    "ç«¯å£ 3": "ç«¯å£ 3 å¯†ç "
  },
  "method": "chacha20-ietf-poly1305"
}
</code></pre><p>è¿™æ˜¯æœ€ç®€å•çš„å¤šç”¨æˆ·é…ç½®æ–‡ä»¶ï¼Œå¦‚æœéœ€è¦æ›´å¤šç”¨æˆ·ï¼Œå°±æ·»åŠ æ›´å¤šè¡Œï¼Œå¦‚æœä¸éœ€è¦å¤šç”¨æˆ·ï¼ŒæŠŠå¤šä½™çš„ä¸¤è¡Œåˆ æ‰å³å¯ã€‚ ï¼ˆæ³¨æ„é™¤æœ€åä¸€è¡Œå¤–æ¯ä¸€è¡Œæœ«å¿…é¡»è¦åŠ è‹±æ–‡çš„åŠè§’é€—å·ï¼‰<p>ä¹‹åæˆ‘ä»¬æ–°å»ºä¸€ä¸ª shadowsocks çš„ systemd é…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶åä¸º <code>shadowsocks.service</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š<pre class=language-conf data-lang=conf><code class=language-conf data-lang=conf>[Unit]
Description=Shadowsocks

[Service]
TimeoutStartSec=0
ExecStart=/usr/bin/ssserver -c /etc/shadowsocks.json

[Install]
WantedBy=multi-user.target
</code></pre><p>æŠŠè¿™ä¸ªæ–‡ä»¶æ”¾è¿› <code>/etc/systemd/system/</code> ç›®å½•ä¸‹ï¼Œç»™å®ƒè¿è¡Œæƒé™ï¼ˆ<code># chmod +x /etc/systemd/system/shadowsocks.service</code>ï¼‰<p>æŠŠå®ƒè®¾ä¸ºå¼€æœºå¯åŠ¨é¡¹ï¼š<p><code># systemctl enable shadowsocks</code><p>è¿™æ · shadowsocks å°±å¯ä»¥å¼€æœºè‡ªåŠ¨è¿è¡Œäº†ã€‚ å¦‚æœä¸æ”¾å¿ƒå¯ä»¥å…ˆé€šè¿‡ systemd å¯åŠ¨ shadowsocks æµ‹è¯•ä¸€ä¸‹ï¼š<p><code># systemctl start shadowsocks</code><p>æŸ¥çœ‹ä¸€ä¸‹æœåŠ¡çŠ¶æ€ï¼š<p><code># systemctl status shadowsocks</code><p>å¦‚æœæ˜¾ç¤ºæ²¡æœ‰é—®é¢˜ï¼Œå°±ç”¨ä½ çš„ shadowsocks å®¢æˆ·ç«¯å°è¯•è¿æ¥ä¸€ä¸‹ï¼Œèƒ½è¿ä¸Šçš„è¯å°±è¯´æ˜æ­å»ºæˆåŠŸäº†ã€‚<h1 id=xie-zai-zui-hou>å†™åœ¨æœ€å</h1><p>åœ¨ 10 æœˆåº•ï¼Œss çš„æµé‡ç‰¹å¾å·²ç»èƒ½é æœºå™¨å­¦ä¹ è¢«æ£€æµ‹åˆ°äº†ï¼Œæœ‰å…³è®ºæ–‡åœ¨<a href=http://ieeexplore.ieee.org/document/8048116/>è¿™é‡Œ</a>ï¼Œä¸­æ–‡ç¿»è¯‘ç‰ˆæœ¬åœ¨<a href=https://juejin.im/post/59dfbd93f265da430d570482>è¿™é‡Œ</a>ï¼ˆè¯·åªå…³æ³¨è¿™ç¯‡è®ºæ–‡çš„æŠ€æœ¯éƒ¨åˆ†ï¼‰ã€‚è¿‘æœŸ GFW çš„åŠ¨ä½œæ˜¯åªå°ç«¯å£ï¼Œé‡åˆ°å¤§æµé‡ä¸”æ— æ³•è¯†åˆ«åè®®çš„æƒ…å†µå°±ä¼šå°æ‰è¿™ä¸ªç«¯å£ï¼Œè§£å†³æ–¹å¼åªæœ‰æ¢æˆå¸¸ç”¨ç«¯å£æˆ–ç›´æ¥æ›´æ¢ IPã€‚<p><strong>çº¸æ˜¯åŒ…ä¸ä½ç«çš„ï¼Œä¸è®ºä»–ä»¬æ€ä¹ˆå»ºå¢™æ©äººè€³ç›®ï¼Œåˆ°å¤´æ¥éƒ½ä¼šæ˜¯è‡ªæ˜åŸå¢“ã€‚</strong><p>æœ€åç”¨ Shadowsocks åŸä½œè€… Clowwindy çš„ä¸€å¥è¯ç»“æŸï¼š<p><strong>I hope one day Iâ€™ll live in a country where I have freedom to write any code I like without fearing.</strong></div><div id=comments-issue-id style=display:none>7</div><div id=comments-addition style=display:none>[{"user":{"login":"amen","avatar_url":"https://secure.gravatar.com/avatar/da30425b4b8732a6caeefb5d45fb8b46?d=retro"},"created_at":"2019-06-29T18:49:58Z","body":"åœ¨åˆ«çš„å¤§ä½¬é‚£é‡Œçœ‹åˆ°è¯´unité‚£é‡ŒåŠ After=network.targetä¼šæ¯”è¾ƒå¥½0.0\n\n[Unit]\nDescription=Shadowsocks Client Service\nAfter=network.target\n\n[Service]\nType=simple\nUser=root\nExecStart=/usr/bin/sslocal -c /home/xx/Software/ShadowsocksConfig/shadowsocks.json\n\n[Install]\nWantedBy=multi-user.target"},{"user":{"login":"EAimTY","html_url":"https://www.eaimty.com/","avatar_url":"https://secure.gravatar.com/avatar/f64037e002ad7b01fe9ee60351bfd1d2?d=retro"},"created_at":"2018-03-01T11:56:59Z","body":"> [Service]\n> TimeoutStartSec=0\n> ExecStart=/usr/bin/ssserver -c /etc/shadowsocks.json\n> \n> è¿™æ®µåªèƒ½ç”¨systemctl enable shadowsockså§ã€‚\n> systemctl start shadowsocks\n> æŠ¥é”™ï¼šUnit etc-systemd-system-shadowsocks.service.mount could not be found.\n\né¢...ä½ è¿™æ˜æ˜¾æ˜¯serviceåé”™äº†ğŸ˜…"},{"user":{"login":"liwl","html_url":"https://www.1iwl.com","avatar_url":"https://secure.gravatar.com/avatar/113b90ef57818573293f2eb3216b5951?d=retro"},"created_at":"2018-02-28T07:17:46Z","body":"[Service]\nTimeoutStartSec=0\nExecStart=/usr/bin/ssserver -c /etc/shadowsocks.json\n\nè¿™æ®µåªèƒ½ç”¨systemctl enable shadowsockså§ã€‚\nsystemctl start shadowsocks\næŠ¥é”™ï¼šUnit etc-systemd-system-shadowsocks.service.mount could not be found."},{"user":{"login":"æ­ªæŸ ","avatar_url":"https://secure.gravatar.com/avatar/bdc22da228fe088bc5c4f7a0932f0342?d=retro"},"created_at":"2021-03-01T07:32:34Z","body":"hahaå¤‡æ¡ˆä¿¡æ¯"}]</div><style>#comment-header,#comment-list>li{margin:1em auto}#comment-avatar,#comment-tip{margin:auto .2em}#comment-action-avatar,#comment-avatar{width:1em;height:1em}#comment-action-info>*,#comment-action-input>*,#comment-info>*{display:inline-block;vertical-align:middle}#comment-header{font-size:1.6em;font-weight:700;line-height:1.6em}#comment-tip{font-style:italic}#comment-list{list-style:none;padding:0}#comment-action-author,#comment-author{font-weight:700;margin:auto .4em}#comment-datetime{font-size:.8em;font-style:italic}#comment-body{margin:auto 1.8em}#comment-action-info>*{margin:1em .2em}#comment-action-input{height:2em;width:100%;margin:1em auto}#comment-action-input>*{height:100%;margin:0 .2em}#comment-action-textarea{width:calc(100% - 8em)}#comment-action-post{width:6em}#comment-action-login{margin:1em .3em}</style><ol id=comment-list></ol><div id=comment-action></div><script>const y=e=>{var t=/\\([\\\|`*_{}\[\]()#+\-~])/g,n=/\n *&gt; *([^]*?)(?=(\n|$){2})/g,i=/\n( *)(?:[*\-+]|((\d+)|([a-z])|[A-Z])[.)]) +([^]*?)(?=(\n|$){2})/g,o=/(^|[^A-Za-z\d\\])(([*_])|(~)|(\^)|(--)|(\+\+)|`)(\2?)([^<]*?)\2\8(?!\2)(?=\W|_|$)/g,a=/^.*\n( *\|( *:?-+:?-+:? *\|)* *\n|)/,c=/.*\n/g,m=/\||(.*?[^\\])\|/g;const l=(t,n)=>{e=e.replace(t,n)},d=(e,t)=>"<"+e+">"+t+"</"+e+">",r=e=>e.replace(n,((e,t)=>d("blockquote",r(u(t.replace(/^ *&gt; */gm,"")))))),s=e=>e.replace(i,((e,t,n,i,o,a)=>(e=d("li",u(a.split(RegExp("\n ?"+t+"(?:(?:\\d+|[a-zA-Z])[.)]|[*\\-+]) +","g")).map(s).join("</li><li>"))),"\n"+(n?'<ol start="'+(i?n+'">':parseInt(n,36)-9+'" style="list-style-type:'+(o?"low":"upp")+'er-alpha">')+e+"</ol>":d("ul",e))))),u=e=>e.replace(o,((e,t,n,i,o,a,c,m,l,r)=>t+d(i?l?"strong":"em":o?l?"s":"sub":a?"sup":c?"small":m?"big":"code",u(r))));var p=[],h=0;return e="\n"+e+"\n",l(/</g,"&lt;"),l(/>/g,"&gt;"),l(/\t|\r|\uf8ff/g,"  "),e=r(e),l(/^([*\-=_] *){3,}$/gm,"<hr/>"),e=s(e),l(/<\/(ol|ul)>\n\n<\1>/g,""),l(/\n((```|~~~).*\n?([^]*?)\n?\2|((    .*?\n)+))/g,((e,t,n,i,o)=>(p[--h]=d("pre",d("code",i||o.replace(/^    /gm,""))),h+"ï£¿"))),l(/((!?)\[(.*?)\]\((.*?)( ".*")?\)|\\([\\`*_{}\[\]()#+\-.!~]))/g,((e,n,i,o,a,c,m)=>(p[--h]=a?i?'<img src="'+a+'" alt="'+o+'"/>':'<a href="'+a+'">'+u(o).replace(t,"$1")+"</a>":m,h+"ï£¿"))),l(/&lt;(.*?)&gt;/g,((e,n)=>'<a href="'+n+'">'+u(n).replace(t,"$1")+"</a>")),l(/\n(( *\|.*?\| *\n)+)/g,((e,n)=>{var i=n.match(a)[1];return"\n"+d("table",n.replace(c,((e,n)=>e==i?"":d("tr",e.replace(m,((e,o,a)=>a?d(i&&!n?"th":"td",u(o||"").replace(t,"$1")):""))))))})),l(/(?=^|>|\n)([>\s]*?)(#{1,6}) (.*?)( #*)? *(?=\n|$)/g,((e,n,i,o)=>n+d("h"+i.length,u(o).replace(t,"$1")))),l(/(?=^|>|\n)\s*\n+([^<]+?)\n+\s*(?=\n|<|$)/g,((e,n)=>d("p",u(n).replace(t,"$1")))),l(/-\d+\uf8ff/g,(e=>p[parseInt(e,10)])),e.trim()},f=e=>{let t=t=>e.next(t),n=t=>e.throw(t);return new Promise(((i,o)=>{let a=e=>{e.done?i(e.value):Promise.resolve(e.value).then(t,n).then(a,o)};a(e.next())}))};let g;const m=document.getElementById("comments-issue-id").innerText,n=new URL(window.location.href);let q,p=n.searchParams.get("github_access_token");p&&(document.cookie=`github_access_token=${p};Path=/;Secure;SameSite=Strict`,n.searchParams.delete("github_access_token"),window.location.replace(n)),null!=p||(p=null==(q=document.cookie.split(";").find((e=>e.trim().startsWith("github_access_token="))))?void 0:q.trim().substring(20));const r=()=>{document.cookie="github_access_token=;expires=Thu, 01 Jan 1970 00:00:00 GMT;Path=/;Secure;SameSite=Strict",p=null},t=()=>f(function*(){var e;let n;if(g=JSON.parse(null!=(n=null==(e=document.getElementById("comments-addition"))?void 0:e.innerText)?n:"[]"),p){if(200!==(e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"GET"})).status)return r(),yield t()}else e=yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}`,{method:"GET"});200===e.status&&(g=g.concat(yield e.json()))}()),u=()=>{g.sort(((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()));let e=document.getElementById("comment-list");e.innerHTML="";var t=document.createElement("div");for(t.id="comment-header",t.innerText="Comments",e.appendChild(t),0===g.length&&((t=document.createElement("div")).id="comment-tip",t.innerText="No comment yet",e.appendChild(t)),t=0;t<g.length;t++){let o=document.createElement("li");var n=document.createElement("div");n.id="comment-info";var i=document.createElement("img");i.id="comment-avatar",i.src=g[t].user.avatar_url,n.appendChild(i),(i=document.createElement("a")).id="comment-author",i.innerText=g[t].user.login,g[t].user.html_url&&(i.href=g[t].user.html_url),n.appendChild(i),(i=document.createElement("div")).id="comment-datetime",i.innerText=new Date(g[t].created_at).toLocaleString(),n.appendChild(i),o.appendChild(n),(n=document.createElement("div")).id="comment-body",n.innerHTML=y(g[t].body),o.appendChild(n),e.appendChild(o)}},v=()=>f(function*(){let e=document.getElementById("comment-action");e.innerHTML="";var n=document.createElement("div");if(n.id="comment-header",n.innerText="Leave a comment",e.appendChild(n),p){if(200===(n=yield fetch(`https://comments.eaimty.com/userinfo?github_access_token=${p}`,{method:"GET"})).status){n=yield n.json();let o=document.createElement("div");o.id="comment-action-info";var i=document.createElement("img");i.id="comment-action-avatar",i.src=n.avatar_url,o.appendChild(i),(i=document.createElement("a")).id="comment-action-author",i.innerText=n.login,i.href=n.html_url,o.appendChild(i);let a=document.createElement("button");a.id="comment-action-logout",a.innerText="Logout",a.addEventListener("click",(()=>{r(),v()})),o.appendChild(a),e.appendChild(o),(n=document.createElement("div")).id="comment-tip",n.innerText="Before commenting, please think about whether your comment is meaningful? Is it related to the topic? Is it rational and friendly? If you were someone else, would you feel uncomfortable seeing this comment?",e.appendChild(n),(n=document.createElement("div")).id="comment-action-input";let c=document.createElement("textarea");c.id="comment-action-textarea",c.placeholder="Leave a comment",n.appendChild(c);let l=document.createElement("button");return l.id="comment-action-post",l.innerText="Comment",l.addEventListener("click",(()=>f(function*(){a.disabled=!0,c.disabled=!0,l.disabled=!0;let e=c.value.trim();0!==e.length&&(201===(yield fetch(`https://comments.eaimty.com/comments?issue_id=${m}&github_access_token=${p}`,{method:"POST",body:JSON.stringify({body:e})})).status?t().then((()=>u())).then((()=>v())):(r(),yield v(),window.alert("Failed to post comment")))}()))),n.appendChild(l),void e.appendChild(n)}r()}(n=document.createElement("div")).id="comment-tip",n.innerText="Clicking the login button means you agree to use cookies to store your GitHub Access Token",e.appendChild(n),(n=document.createElement("button")).id="comment-action-login",n.innerText="Login with GitHub",n.addEventListener("click",(()=>window.location.replace(`https://comments.eaimty.com/login?redirect_uri=${window.location.href}`))),e.appendChild(n)}());t().then((()=>u())).then((()=>v()))</script></div>